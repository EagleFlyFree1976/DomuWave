import{S as q,v as _,U as b,f as F,W as N,r as E,h as j,s as B,l as I,c as w,o as h,a as x,b as r,d as s,i as f,w as p,x as C,e as L,t as $,F as T,_ as G,g as O,j as W,k as R,E as Y}from"./app.js";import{a as M}from"./systemApi.js";import{_ as H,s as J}from"./Error404.js";import{s as K}from"./index2.js";import{s as v}from"./index3.js";import{a as D,b as Q,s as X}from"./index.js";const U=q("paymentMethodStore",{state:()=>({paymentmethods:null,createmode:!1,loading:!1,error:null,edititem:null,createitem:null}),actions:{async loadDashboard(i){var a,t;const l=_();this.loading=!0,this.error=null;try{const e=await accountApi.get(`/Accounts/${i}/dashboard`);this.dashboarddata=e.data,console.log("this.dashboarddata",this.dashboarddata)}catch(e){console.log("Error",e),l.setMessages("Non è stato possibile caricare la dashboard dell'account specificato",b.error),this.error=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Errore durante il caricamento dell'account specificato"}finally{this.loading=!1}},async createEntity(i){await this.updateEntity(i)},async updateEntity(i){var t,e;const l=_(),a=F();this.loading=!0,this.error=null;try{let n="/Admin/PaymentMethods",g=null;i.id!=0?(n=`${n}/${i.id}`,g=await M.put(n,{name:i.name,description:i.description})):(g=await M.post(n,{name:i.name,description:i.description}),this.edititem.id=g.headers["x-key"],i.id=g.headers["x-key"],this.createmode=!1),a.loadMenu(),this.edititem={...i},this.createmode=!1,l.addMessage(N.SUCCESS.SAVE,b.success),console.log("this.edititem",this.edititem)}catch(n){console.log("Error",n),l.setMessages(n.response.data.Errors,b.error),this.error=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||N.ERROR.SAVE}finally{this.loading=!1}},async newEntity(){this.createmode=!0,this.edititem={name:"[New]",description:"",id:0}},async edit(i){var a,t;const l=_();this.loading=!0,this.error=null;try{const e=await M.get(`/PaymentMethods/${i}`);this.edititem=e.data,this.createmode=!1,console.log("this.edititem",this.edititem)}catch(e){console.log("Error",e),l.setMessages("Non è stato possibile caricare i dati",b.error),this.error=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Errore durante il caricamento dei dati"}finally{this.loading=!1}},async deletePaymentMethod(i){var a,t;const l=_();this.loading=!0,this.error=null;try{const e=await M.delete(`/PaymentMethods/${i}`);await this.loadAllPaymentMethods()}catch(e){console.log("Error",e),l.setMessages(e.response.data.Errors,b.error),this.error=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Errore durante il caricamento dei metodi di pagamento"}finally{this.loading=!1}},async disablePaymentMethod(i){var a,t;const l=_();this.loading=!0,this.error=null;try{const e=await M.patch(`/PaymentMethods/${i}/disable`);await this.loadAllPaymentMethods()}catch(e){console.log("Error",e),l.setMessages(e.response.data.Errors,b.error),this.error=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Errore durante il caricamento dei metodi di pagamento"}finally{this.loading=!1}},async enablePaymentMethod(i){var a,t;const l=_();this.loading=!0,this.error=null;try{const e=await M.patch(`/PaymentMethods/${i}/enable`);await this.loadAllPaymentMethods()}catch(e){console.log("Error",e),l.setMessages(e.response.data.Errors,b.error),this.error=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Errore durante il caricamento dei metodi di pagamento"}finally{this.loading=!1}},async loadAllPaymentMethods(){var l,a;const i=_();this.loading=!0,this.error=null;try{const t=await M.get("/PaymentMethods");this.paymentmethods=t.data}catch(t){console.log("Error",t),i.setMessages("Non è stato possibile caricare i metodi di pagamento",b.error),this.error=((a=(l=t.response)==null?void 0:l.data)==null?void 0:a.message)||"Errore durante il caricamento dei metodi di pagamento"}finally{this.loading=!1}}},computed:{}}),Z={key:0},ee={class:"card shadow mb-4"},te={class:"card-body"},se={class:"container-fluid mt-4"},ae={class:"w-50"},oe={class:"card flex justify-center mt-4"},ie={class:"row mb-3"},le={class:"col-sm-9"},re={class:"row mb-3"},ne={class:"col-sm-9"},de={key:1},ce={__name:"PaymentEditForm",setup(i,{expose:l}){var a=E(!1);const t=U();_();const e=F();var n=E({...t.edititem});const g=E(null),S=E(null);console.log("editEntity ",n);const V=({values:y})=>{const m={};return n.value.name||(m.name=[{message:"Il nome è obbligatorio."}]),{errors:m}};console.log("onFormSubmit pre");async function A(){return new Promise(async y=>{S.value?(g.value=y,await S.value.submit(),y(!0)):y(!1)})}const z=async({valid:y})=>{let m=!1;y&&(a.value=!0,console.log("editEntity",n.value),t.createmode?await t.createEntity(n.value):await t.updateEntity(n.value),a.value=!1),g.value&&(g.value(m),g.value=null)};console.log("onFormSubmit after");async function P(){}return j(async()=>{await P()}),l({submitForm:A}),B(()=>t.edititem,y=>{y!=null&&(n.value={...t.edititem})},{immediate:!0}),(y,m)=>{const k=I("Message");return h(),w(T,null,[r(t).edititem!=null?(h(),w("div",Z,[s("div",ee,[s("div",te,[s("div",se,[s("div",ae,[s("div",oe,[f(r(Q),{ref_key:"formRef",ref:S,resolver:V,onSubmit:z,class:"flex flex-col gap-4 w-full sm:w-56 mt-2 ml-2"},{default:p(d=>{var o,c;return[s("div",ie,[m[2]||(m[2]=s("label",{for:"name",class:"col-sm-3 col-form-label"},"Nome",-1)),s("div",le,[f(r(D),{name:"name",type:"text",placeholder:"Inserisci il nome",fluid:"",modelValue:r(n).name,"onUpdate:modelValue":m[0]||(m[0]=u=>r(n).name=u),class:"form-control"},null,8,["modelValue"]),(o=d.name)!=null&&o.invalid?(h(),C(k,{key:0,severity:"error",size:"small",variant:"simple"},{default:p(()=>{var u;return[L($((u=d.name.error)==null?void 0:u.message),1)]}),_:2},1024)):x("",!0)])]),s("div",re,[m[3]||(m[3]=s("label",{for:"description",class:"col-sm-3 col-form-label"},"Descrizione",-1)),s("div",ne,[f(r(D),{name:"description",type:"text",placeholder:"Inserisci la descrizione",fluid:"",modelValue:r(n).description,"onUpdate:modelValue":m[1]||(m[1]=u=>r(n).description=u),class:"form-control"},null,8,["modelValue"]),(c=d.description)!=null&&c.invalid?(h(),C(k,{key:0,severity:"error",size:"small",variant:"simple"},{default:p(()=>{var u;return[L($((u=d.description.error)==null?void 0:u.message),1)]}),_:2},1024)):x("",!0)])])]}),_:1},512)])])])])])])):x("",!0),r(t).edititem==null&&!r(e).loading?(h(),w("div",de,[f(H,{backaction:/PaymentMethods/})])):x("",!0)],64)}}},me={class:"card"},ue={class:"flex items-center gap-2"},fe={class:"card shadow mb-4"},pe={class:"card-body"},ye={class:"table-responsive"},ge={class:"table table-bordered table-striped",id:"dataTable",width:"100%",cellspacing:"0"},he={style:{display:"flex","justify-content":"flex-end",gap:"0.5rem","margin-top":"1rem"}},be={__name:"PaymentMethodsView",props:{paymentmethodid:Number},setup(i){const l=U();var a=E(!1);const t=E(null),e=F(),n=O(),g=i;async function S(d){e.startLoading(),await l.deletePaymentMethod(d),e.stopLoading()}const V=async d=>{e.startLoading(),await l.disablePaymentMethod(d),e.stopLoading()},A=async d=>{e.startLoading(),await l.enablePaymentMethod(d),e.stopLoading()},z=(d,o)=>{n.require({target:d.currentTarget,message:"Sei sicuro di voler procedere con la cancellazione del metodo di pagamento selezionato?",icon:"fas fa-exclamation-triangle yellow",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Cancella",class:"bg-danger"},accept:()=>{S(o)},reject:()=>{}})};async function P(){e.startLoading(),await l.loadAllPaymentMethods(),e.stopLoading()}j(async()=>{await P()}),B(()=>g.paymentmethodid,d=>{d!=null&&(d!=0?y(d):m())},{immediate:!0});async function y(d){await l.edit(d),a.value=!0}function m(){l.newEntity(),a.value=!0}async function k(){await t.value.submitForm()&&setTimeout(async function(){await P(),a.value=!1},500)}return(d,o)=>(h(),w("div",null,[s("div",me,[f(r(J),{style:{padding:"1rem 1rem 1rem 1.5rem"}},{start:p(()=>o[4]||(o[4]=[s("h1",{class:"h3 mb-0 text-gray-800"},"Metodi di pagamento",-1)])),center:p(()=>o[5]||(o[5]=[])),end:p(()=>[s("div",ue,[f(r(v),{label:"Refresh",text:"",plain:"",onClick:P},{default:p(()=>o[6]||(o[6]=[s("i",{class:"fas fa-sync-alt"},null,-1)])),_:1,__:[6]}),f(r(v),{as:"a",label:"Crea Metodo di pagamento",text:"",plain:"",onClick:o[0]||(o[0]=c=>m())},{default:p(()=>o[7]||(o[7]=[s("i",{class:"fa fa-plus-square"},null,-1)])),_:1,__:[7]})])]),_:1})]),s("div",fe,[s("div",pe,[s("div",ye,[f(r(K)),s("table",ge,[o[12]||(o[12]=s("thead",null,[s("tr",null,[s("th",{class:"text-muted"},"Name"),s("th",{class:"text-muted"},"Description"),s("th")])],-1)),s("tbody",null,[(h(!0),w(T,null,W(r(l).paymentmethods,c=>(h(),w("tr",{key:c.id,class:Y({"row-disabled":!c.enabled})},[s("td",null,$(c.name),1),s("td",null,$(c.description),1),s("td",null,[f(r(v),{onClick:u=>y(c.id),label:"Modifica",severity:"default",outlined:""},{default:p(()=>o[8]||(o[8]=[s("i",{class:"far fa-edit"},null,-1)])),_:2,__:[8]},1032,["onClick"]),f(r(v),{onClick:u=>z(u,c.id),label:"Delete",severity:"danger",outlined:""},{default:p(()=>o[9]||(o[9]=[s("i",{class:"far fa-minus-square"},null,-1)])),_:2,__:[9]},1032,["onClick"]),c.enabled?(h(),C(r(v),{key:0,onClick:u=>V(c.id),label:"Disabilita",severity:"success",outlined:"",title:"Disabilita"},{default:p(()=>o[10]||(o[10]=[s("i",{class:"fas fa-toggle-off"},null,-1)])),_:2,__:[10]},1032,["onClick"])):(h(),C(r(v),{key:1,onClick:u=>A(c.id),label:"Abilita",severity:"danger",outlined:"",title:"Abilita"},{default:p(()=>o[11]||(o[11]=[s("i",{class:"fas fa-toggle-on"},null,-1)])),_:2,__:[11]},1032,["onClick"]))])],2))),128))])])])])]),f(r(X),{header:"Metodo di pagamento",visible:r(a),"onUpdate:visible":o[3]||(o[3]=c=>R(a)?a.value=c:a=c),modal:!0,closable:!0,style:{width:"50rem"}},{default:p(()=>[f(ce,{ref_key:"editForm",ref:t},null,512),s("div",he,[f(r(v),{type:"button",label:"Cancel",severity:"secondary",onClick:o[1]||(o[1]=c=>R(a)?a.value=!1:a=!1)}),f(r(v),{type:"button",label:"Save",class:"bg-gray-800 text-white border-none hover:bg-gray-800",onClick:o[2]||(o[2]=c=>k())})])]),_:1},8,["visible"])]))}},Pe=G(be,[["__scopeId","data-v-8e936fc2"]]);export{Pe as default};
