import{S as ee,v as P,U as A,f as N,W as q,r as h,h as W,s as Y,l as te,c as F,o as _,a as k,b as a,d as e,i as u,w as v,x as L,e as z,t as w,F as J,_ as ae,g as se,j as le,k as G,m as oe,n as re}from"./app.js";import{a as I}from"./systemApi.js";import{t as M}from"./index4.js";import{_ as ie,s as ne}from"./Error404.js";import{s as de}from"./index2.js";import{s as $}from"./index3.js";import{s as K,a as Q}from"./index6.js";import{a as ce,b as ue,s as me}from"./index.js";import{s as O}from"./index11.js";import{S as U}from"./SortField.js";import"./index5.js";import"./index7.js";const X=ee("exchangeRateHistoryStore",{state:()=>({exchangeRateHistory:null,pageSize:20,page:1,totalRecords:null,totalPages:null,createmode:!1,loading:!1,error:null,edititem:null,createitem:null,targetDate:null,toCurrencyId:null,sortBy:null,sortAscending:null}),actions:{async createEntity(c){return await this.updateEntity(c)},async updateEntity(c){var i,g;const l=P();N(),this.loading=!0,this.error=null;try{let o="/currencies/exchange",n=null;return c.id!=0?(o=`${o}/${c.id}`,n=await I.put(o,{toCurrencyId:c.toCurrency.id,rate:c.rate,targetDate:M(c.validFrom)})):(n=await I.post(o,{toCurrencyId:c.toCurrency.id,rate:c.rate,targetDate:M(c.validFrom)}),this.edititem.id=n.headers["x-key"],c.id=n.headers["x-key"],this.createmode=!1),this.edititem={...c},this.createmode=!1,l.addMessage(q.SUCCESS.SAVE,A.success),console.log("this.edititem",this.edititem),!0}catch(o){return console.log("Error",o),l.setMessages(o.response.data.Errors,A.error),this.error=((g=(i=o.response)==null?void 0:i.data)==null?void 0:g.message)||q.ERROR.SAVE,!1}finally{this.loading=!1}},async newEntity(){this.createmode=!0,this.edititem={toCurrencyId:{id:null,description:null},rate:null,validFrom:new Date,id:0}},async edit(c){var i,g;const l=P();this.loading=!0,this.error=null;try{const o=await I.get(`/currencies/exchange/${c}`);this.edititem=o.data,this.createmode=!1,console.log("this.edititem",this.edititem)}catch(o){console.log("Error",o),l.setMessages("Non è stato possibile caricare i dati",A.error),this.error=((g=(i=o.response)==null?void 0:i.data)==null?void 0:g.message)||"Errore durante il caricamento dei dati"}finally{this.loading=!1}},async deleteExchangeRateHistory(c){var i,g;const l=P();this.loading=!0,this.error=null;try{const o=await I.delete(`/currencies/exchange/${c}`);await this.loadAllexchangeRateHistory(this.targetDate,this.toCurrencyId,this.sortBy,this.sortAscending)}catch(o){console.log("Error",o),l.setMessages(o.response.data.Errors,A.error),this.error=((g=(i=o.response)==null?void 0:i.data)==null?void 0:g.message)||"Errore durante il caricamento dei metodi di pagamento"}finally{this.loading=!1}},async onPageChange(c){this.page=c,await this.loadAllexchangeRateHistory(this.targetDate,this.toCurrencyId,this.sortBy,this.sortAscending)},async filterAllexchangeRateHistory(c,l,i,g){this.page=1,this.pageSize=20,await this.loadAllexchangeRateHistory(c,l,i,g)},async loadAllexchangeRateHistory(c,l,i,g){var R,V;const o=P();this.loading=!0,this.error=null;try{this.targetDate=c,this.toCurrencyId=l,this.sortBy=i,this.sortAscending=g;var n=this.targetDate?M(this.targetDate):"",f=this.toCurrencyId?this.toCurrencyId:"",C=this.page?this.page:1,d=this.pageSize?this.pageSize:20,x=this.sortBy?this.sortBy:"",E=this.sortAscending?this.sortAscending=="asc":!0;const y=await I.get(`/currencies/exchange?targetDate=${n}&toCurrencyId=${f}&page=${C}&pageSize=${d}&sortBy=${x}&asc=${E}`);this.exchangeRateHistory=y.data.items,this.pageSize=y.data.pageSize,this.page=y.data.pageNumber,this.totalRecords=y.data.totalCount,this.totalPages=y.data.totalPages}catch(y){console.log("Error",y),o.setMessages("Non è stato possibile caricare i metodi di pagamento",A.error),this.error=((V=(R=y.response)==null?void 0:R.data)==null?void 0:V.message)||"Errore durante il caricamento dei metodi di pagamento"}finally{this.loading=!1}}},computed:{}}),ge={key:0},fe={class:"card shadow mb-4"},ve={class:"card-body"},pe={class:"container-fluid mt-4"},ye={class:"w-50"},he={class:""},be={class:"row mb-3"},_e={class:"col-sm-9"},Se={class:"row mb-3"},Ce={class:"col-sm-9"},xe={class:"row mb-3"},we={class:"col-sm-9"},Ee={key:1},Fe={__name:"ExchangeRateHistoryEditForm",setup(c,{expose:l}){var i=h(!1);const g=h([]),o=async p=>{console.log("Carico le valute",p.query),g.value=await C.loadCurrencies(p.query),console.log("Ho caricato le valute:",g)},n=X(),f=P(),C=N();var d=h({...n.edititem});const x=h(null),E=h(null);console.log("editEntity ",d);const R=({values:p})=>{const r={};return d.value.toCurrency==null&&(r.currency=[{message:"Selezionare la valuta di riferimento."}]),console.log("editEntity.value.validFrom ",d.value.validFrom),(d.value.validFrom==null||d.value.validFrom=="")&&(r.validFrom=[{message:"Selezionare la data di riferimento."}]),d.value.rate==null&&(r.rate=[{message:"Specificare il tasso di cambio."}]),{errors:r}};console.log("onFormSubmit pre");async function V(){return new Promise(async p=>{E.value?(x.value=p,await E.value.submit()):p(!1)})}const y=async({valid:p})=>{let r=!1;if(p){i.value=!0;try{n.createmode?r=await n.createEntity(d.value):r=await n.updateEntity(d.value)}catch(b){console.error("Errore nel salvataggio:",b),f.showError("Errore durante il salvataggio del cambio valuta."),r=!1}finally{i.value=!1}}x.value&&(console.log("onFormSubmit resolve",r),x.value(r),console.log("onFormSubmit resolve 2",r),x.value=null)};console.log("onFormSubmit after");async function B(){}return W(async()=>{await B()}),l({submitForm:V}),Y(()=>n.edititem,p=>{p!=null&&(d.value={...n.edititem})},{immediate:!0}),(p,r)=>{const b=te("Message");return _(),F(J,null,[a(n).edititem!=null?(_(),F("div",ge,[e("div",fe,[e("div",ve,[e("div",pe,[e("div",ye,[e("div",he,[u(a(ue),{ref_key:"formRef",ref:E,resolver:R,onSubmit:y,class:"flex flex-col gap-4 w-full sm:w-56 mt-2 ml-2"},{default:v(S=>{var D,H,T;return[e("div",be,[r[3]||(r[3]=e("label",{for:"name",class:"col-sm-3 col-form-label"},"Valuta",-1)),e("div",_e,[u(a(K),{disabled:!a(n).createmode,name:"currency",optionLabel:"description",modelValue:a(d).toCurrency,"onUpdate:modelValue":r[0]||(r[0]=s=>a(d).toCurrency=s),suggestions:g.value,forceSelection:"",fluid:"",minLength:"2",onComplete:o,placeholder:"Seleziona la valuta"},null,8,["disabled","modelValue","suggestions"]),(D=S.currency)!=null&&D.invalid?(_(),L(b,{key:0,severity:"error",size:"small",variant:"simple"},{default:v(()=>{var s;return[z(w((s=S.currency.error)==null?void 0:s.message),1)]}),_:2},1024)):k("",!0)])]),e("div",Se,[r[4]||(r[4]=e("label",{for:"targetdate",class:"col-sm-3 col-form-label"}," Data ",-1)),e("div",Ce,[u(a(Q),{name:"validFrom",fluid:"",modelValue:a(d).validFrom,"onUpdate:modelValue":r[1]||(r[1]=s=>a(d).validFrom=s),disabled:!a(n).createmode,dateFormat:a(C).options.dateFormat,placeholder:"Seleziona la data"},null,8,["modelValue","disabled","dateFormat"]),(H=S.validFrom)!=null&&H.invalid?(_(),L(b,{key:0,severity:"error",size:"small",variant:"simple"},{default:v(()=>{var s;return[z(w((s=S.validFrom.error)==null?void 0:s.message),1)]}),_:2},1024)):k("",!0)])]),e("div",xe,[r[5]||(r[5]=e("label",{for:"rate",class:"col-sm-3 col-form-label"}," Tasso ",-1)),e("div",we,[u(a(ce),{name:"rate",type:"number",placeholder:"Specifica il tasso",fluid:"",modelValue:a(d).rate,"onUpdate:modelValue":r[2]||(r[2]=s=>a(d).rate=s),class:"form-control"},null,8,["modelValue"]),(T=S.rate)!=null&&T.invalid?(_(),L(b,{key:0,severity:"error",size:"small",variant:"simple"},{default:v(()=>{var s;return[z(w((s=S.rate.error)==null?void 0:s.message),1)]}),_:2},1024)):k("",!0)])])]}),_:1},512)])])])])])])):k("",!0),a(n).edititem==null&&!a(C).loading?(_(),F("div",Ee,[u(ie,{backaction:/PaymentMethods/})])):k("",!0)],64)}}},Re={class:"card"},Ve={class:"flex items-center gap-2"},$e={class:"card shadow mb-4"},ke={class:"card-header d-flex justify-content-between align-items-center"},ze={class:"d-flex align-items-center gap-2"},De={class:"d-flex justify-content-end align-items-center gap-3"},He={class:"card-body"},Ae={class:"table-responsive"},Ie={class:"table table-bordered table-striped",id:"dataTable",width:"100%",cellspacing:"0"},Pe={class:"text-muted"},Te={class:"text-muted"},Be={class:"text-muted"},Le={class:"text-start align-middle"},Me={class:"text-start align-middle"},Ue={class:"text-start align-middle"},Ne={class:"text-start align-middle"},je={key:0},qe={colspan:"4"},Ge={class:"d-flex justify-content-end align-items-center gap-3"},Oe={style:{display:"flex","justify-content":"flex-end",gap:"0.5rem","margin-top":"1rem"}},We={__name:"CurrenciesView",props:{ExchangeRateHistoryid:Number},setup(c){const l=X();var i=h(!1);const g=h([]),o=h(null),n=h(null);h(null);const f=h({field:"ValidFrom",direction:"asc"}),C=h(null),d=N(),x=se(),E=c;async function R(s){d.startLoading(),console.log("e",l),await l.deleteExchangeRateHistory(s),d.stopLoading()}const V=async s=>{console.log("Carico le valute",s.query),g.value=await d.loadCurrencies(s.query),console.log("Ho caricato le valute:",g)},y=(s,t)=>{x.require({target:s.currentTarget,message:"Sei sicuro di voler procedere con la cancellazione del tasso di cambio selezionato?",icon:"fas fa-exclamation-triangle yellow",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Cancella",class:"bg-danger"},accept:async()=>{await R(t)},reject:()=>{}})},B=async s=>{o.value=s,console.log("Data aggiornata:",s),await p()};async function p(){console.log("FILTER",o),d.startLoading();var s=n!=null&&n.value!=null?n.value.id:null,t=o!=null&&o.value!=null?o.value:null;await l.filterAllexchangeRateHistory(t,s,f.value.field,f.value.direction),d.stopLoading()}async function r(s){f.value=s,await b()}async function b(){d.startLoading();var s=n!=null&&n.value!=null?n.value.id:null,t=o!=null&&o.value!=null?o.value:null;console.log("nuovo sort rerf",f,f.value),await l.filterAllexchangeRateHistory(t,s,f.value.field,f.value.direction),d.stopLoading()}W(async()=>{await b()}),Y(()=>E.ExchangeRateHistoryid,s=>{s!=null&&(s!=0?S(s):D())},{immediate:!0});async function S(s){await l.edit(s),i.value=!0}function D(){l.newEntity(),i.value=!0}async function H(s){l.onPageChange(s.page+1)}async function T(){await C.value.submitForm()&&setTimeout(async function(){await b(),i.value=!1},500)}return(s,t)=>{const Z=oe("date");return _(),F("div",null,[e("div",Re,[u(a(ne),{style:{padding:"1rem 1rem 1rem 1.5rem"}},{start:v(()=>t[8]||(t[8]=[e("h1",{class:"h3 mb-0 text-gray-800"},"Tassi di cambio",-1)])),center:v(()=>t[9]||(t[9]=[])),end:v(()=>[e("div",Ve,[u(a($),{label:"Refresh",text:"",plain:"",onClick:b},{default:v(()=>t[10]||(t[10]=[e("i",{class:"fas fa-sync-alt"},null,-1)])),_:1,__:[10]}),u(a($),{as:"a",label:"Crea Tasso ",text:"",plain:"",onClick:t[0]||(t[0]=m=>D())},{default:v(()=>t[11]||(t[11]=[e("i",{class:"fa fa-plus-square"},null,-1)])),_:1,__:[11]})])]),_:1})]),e("div",$e,[e("div",ke,[e("div",ze,[u(a(K),{class:"d-inline-block w-auto me-2",name:"currency",optionLabel:"description",modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=m=>n.value=m),suggestions:g.value,forceSelection:"",fluid:"",minLength:"2",onItemSelect:p,onComplete:V,placeholder:"Filtra per valuta"},null,8,["modelValue","suggestions"]),u(a(Q),{name:"targetDate",fluid:"","onUpdate:modelValue":B,dateFormat:a(d).options.dateFormat,placeholder:"Cerca per data"},null,8,["dateFormat"])]),e("div",De,[e("span",null,"Totale: "+w(a(l).totalRecords),1),u(a(O),{rows:a(l).pageSize,totalRecords:a(l).totalRecords,first:(a(l).page-1)*a(l).pageSize,onPage:H},null,8,["rows","totalRecords","first"])])]),e("div",He,[e("div",Ae,[u(a(de)),e("table",Ie,[e("thead",null,[e("tr",null,[e("th",Pe,[u(U,{modelValue:f.value,"onUpdate:modelValue":[t[2]||(t[2]=m=>f.value=m),r],field:"ToCurrency"},{default:v(()=>t[12]||(t[12]=[z(" Name ")])),_:1,__:[12]},8,["modelValue"])]),e("th",Te,[u(U,{modelValue:f.value,"onUpdate:modelValue":[t[3]||(t[3]=m=>f.value=m),r],field:"ValidFrom"},{default:v(()=>t[13]||(t[13]=[z(" Data ")])),_:1,__:[13]},8,["modelValue"])]),e("th",Be,[u(U,{modelValue:f.value,"onUpdate:modelValue":[t[4]||(t[4]=m=>f.value=m),r],field:"Rate"},{default:v(()=>t[14]||(t[14]=[z(" Valuta ")])),_:1,__:[14]},8,["modelValue"])]),t[15]||(t[15]=e("th",null,null,-1))])]),e("tbody",null,[(_(!0),F(J,null,le(a(l).exchangeRateHistory,m=>(_(),F("tr",{key:m.id},[e("td",Le,w(m.toCurrency.code)+" - "+w(m.toCurrency.description),1),re(e("td",Me,null,512),[[Z,m.validFrom,"date"]]),e("td",Ue,w(m.rate),1),e("td",Ne,[u(a($),{onClick:j=>S(m.id),label:"Modifica",severity:"default",outlined:""},{default:v(()=>t[16]||(t[16]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[16]},1032,["onClick"]),u(a($),{onClick:j=>y(j,m.id),label:"Delete",severity:"danger",outlined:""},{default:v(()=>t[17]||(t[17]=[e("i",{class:"far fa-minus-square"},null,-1)])),_:2,__:[17]},1032,["onClick"])])]))),128)),a(l).exchangeRateHistory!=null&&a(l).exchangeRateHistory.length===0?(_(),F("tr",je,t[18]||(t[18]=[e("td",{colspan:"4",class:"text-center text-muted fst-italic py-3"}," Nessun tasso di cambio trovato. ",-1)]))):k("",!0)]),e("tfoot",null,[e("tr",null,[e("td",qe,[e("div",Ge,[e("span",null,"Totale: "+w(a(l).totalRecords),1),u(a(O),{rows:a(l).pageSize,totalRecords:a(l).totalRecords,first:(a(l).page-1)*a(l).pageSize,onPage:H},null,8,["rows","totalRecords","first"])])])])])])])])]),u(a(me),{header:"Tasso di cambio",visible:a(i),"onUpdate:visible":t[7]||(t[7]=m=>G(i)?i.value=m:i=m),modal:!0,closable:!0,style:{width:"50rem"}},{default:v(()=>[u(Fe,{ref_key:"editForm",ref:C},null,512),e("div",Oe,[u(a($),{type:"button",label:"Cancel",severity:"secondary",onClick:t[5]||(t[5]=m=>G(i)?i.value=!1:i=!1)}),u(a($),{type:"button",label:"Save",class:"bg-gray-800 text-white border-none hover:bg-gray-800",onClick:t[6]||(t[6]=m=>T())})])]),_:1},8,["visible"])])}}},rt=ae(We,[["__scopeId","data-v-e649a798"]]);export{rt as default};
