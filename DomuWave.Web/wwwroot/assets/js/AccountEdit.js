import{u as P}from"./accountStore.js";import{v as Q,f as W,r as b,h as X,s as L,c as D,a as u,b as a,d as l,i,w as r,x as y,t as m,e as g,k as A,F as Y,l as Z,o as d}from"./app.js";import{s as $,_ as ee}from"./Error404.js";import{s as _}from"./index3.js";import{s as ae,a as te}from"./index5.js";import{_ as le}from"./AccountCreateForm.js";import{a as I,b as oe,s as se}from"./index.js";import{s as ie,a as R}from"./index6.js";import{A as ne}from"./AccountTabber.js";import"./accountApi.js";import"./index4.js";import"./index7.js";import"./index8.js";const re={key:0},ce={class:"card"},de={class:"h3 mb-0 text-gray-800"},ue={class:"flex items-center gap-2"},me={class:"card shadow mb-4"},pe={class:"card-body"},ve={class:"container-fluid mt-4"},ye={class:"w-50"},fe={class:"flex justify-center"},be={class:"row mb-3"},ge={class:"col-sm-9"},_e={key:1},we={class:"row mb-3"},De={class:"col-sm-9"},Ve={class:"row mb-3"},ke={class:"col-sm-9"},Se={class:"row mb-3"},xe={class:"col-sm-9"},Ce={class:"row mb-3"},Fe={class:"col-sm-9"},Ee={class:"row mb-3"},ze={class:"col-sm-9"},Te={class:"row mb-3"},Ne={class:"col-sm-9"},Be={style:{display:"flex","justify-content":"flex-end",gap:"0.5rem","margin-top":"1rem"}},Ue={key:1},Pe={__name:"AccountEdit",props:{accountid:Number},setup(M){const n=P();Q();const p=W(),S=M;var w=b(!1),o=b({...n.edititem});const x=b(null);var v=b(!1);const V=b([]),C=b([]),k=b(null);console.log("editEntity ",o);const q=({values:c})=>{const e={};return o.value.name||(e.name=[{message:"Il nome è obbligatorio."}]),o.value.accountType==null&&(e.accountType=[{message:"Specificare la tipologia di account"}]),(o.value.openDate==null||isNaN(new Date(o.value.openDate)))&&(e.openDate=[{message:"Il campo data apertura è obbligatorio."}]),o.value.closedDate!=null&&isNaN(new Date(o.value.closedDate))&&(e.closedDate=[{message:"Il campo data chiusura non è corretto!."}]),o.value.currency==null&&(e.currency=[{message:"Specificare la valuta del conto"}]),{errors:e}};console.log("onFormSubmit pre");const j=async()=>{k.value&&await k.value.submit()},G=async({valid:c})=>{c&&(w.value=!0,console.log("editEntity",o.value),n.createmode?await n.createEntity(o.value):await n.updateEntity(o.value),w.value=!1)};console.log("onFormSubmit after");async function F(){p.startLoading(),C.value=await p.loadAccountTypes(),p.stopLoading()}function H(){n.undoNewEntity()}function J(){v.value=!0}async function K(){await x.value.submitForm()&&(v.value=!1)}X(async()=>{console.log("onmounted"),console.log("accountStore.newEntity(); called"),await F()}),console.log("setup"),n.newEntity(),console.log("accountStore.newEntity(); called on setup");const O=async c=>{console.log("Carico le valute",c.query),V.value=await p.loadCurrencies(c.query),console.log("Ho caricato le valute:",V)};return L(()=>S.accountid,c=>{c!=null&&(c!=0?(p.startLoading(),n.edit(c),p.stopLoading()):n.newEntity())},{immediate:!0}),L(()=>n.edititem,c=>{c!=null&&(o.value={...n.edititem})},{immediate:!0}),(c,e)=>{const f=Z("Message");return d(),D(Y,null,[a(n).edititem!=null?(d(),D("div",re,[l("div",ce,[i(a($),{style:{padding:"1rem 1rem 1rem 1.5rem"}},{start:r(()=>[l("h1",de," ["+m(a(n).edititem.id)+"] "+m(a(n).edititem.name),1)]),center:r(()=>e[11]||(e[11]=[])),end:r(()=>[l("div",ue,[i(a(_),{label:"Refresh",text:"",plain:"",onClick:F},{default:r(()=>e[12]||(e[12]=[l("i",{class:"fas fa-sync-alt"},null,-1)])),_:1,__:[12]}),i(a(_),{as:"a",label:"Crea account",text:"",plain:"",onClick:e[0]||(e[0]=s=>J())},{default:r(()=>e[13]||(e[13]=[l("i",{class:"fa fa-plus-square"},null,-1)])),_:1,__:[13]}),a(n).createmode?(d(),y(a(_),{key:0,severity:"secondary",label:"Annulla",class:"btn btn-warning align-content-end",loading:a(w),onClick:H},null,8,["loading"])):u("",!0),i(a(_),{severity:"secondary",label:"Salva",class:"btn btn-primary align-content-end",loading:a(w),onClick:j},null,8,["loading"])])]),_:1}),i(ne,{accountid:S.accountid},null,8,["accountid"])]),l("div",me,[l("div",pe,[l("div",ve,[l("div",ye,[l("div",fe,[i(a(oe),{ref_key:"formRef",ref:k,resolver:q,onSubmit:G,class:"flex flex-col gap-4 w-full sm:w-56 mt-2 ml-2"},{default:r(s=>{var E,z,T,N,B,U,h;return[l("div",be,[e[14]||(e[14]=l("label",{for:"accountType",class:"col-sm-3 col-form-label"},"Tipo",-1)),l("div",ge,[a(n).createmode?(d(),y(a(ae),{key:0,name:"accountType",modelValue:a(o).accountType,"onUpdate:modelValue":e[1]||(e[1]=t=>a(o).accountType=t),options:C.value,optionLabel:"description",placeholder:"Seleziona la tipologia di account"},null,8,["modelValue","options"])):(d(),D("span",_e,m(a(o).accountType.description),1)),(E=s.accountType)!=null&&E.invalid?(d(),y(f,{key:2,severity:"error",size:"small",variant:"simple"},{default:r(()=>{var t;return[g(m((t=s.accountType.error)==null?void 0:t.message),1)]}),_:2},1024)):u("",!0)])]),l("div",we,[e[15]||(e[15]=l("label",{for:"name",class:"col-sm-3 col-form-label"},"Nome",-1)),l("div",De,[i(a(I),{name:"name",type:"text",placeholder:"Inserisci il nome",fluid:"",modelValue:a(o).name,"onUpdate:modelValue":e[2]||(e[2]=t=>a(o).name=t),class:"form-control"},null,8,["modelValue"]),(z=s.name)!=null&&z.invalid?(d(),y(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:r(()=>{var t;return[g(m((t=s.name.error)==null?void 0:t.message),1)]}),_:2},1024)):u("",!0)])]),l("div",Ve,[e[16]||(e[16]=l("label",{for:"description",class:"col-sm-3 col-form-label"},"Descrizione",-1)),l("div",ke,[i(a(I),{name:"description",type:"text",placeholder:"Inserisci la descrizione",fluid:"",modelValue:a(o).description,"onUpdate:modelValue":e[3]||(e[3]=t=>a(o).description=t),class:"form-control"},null,8,["modelValue"]),(T=s.description)!=null&&T.invalid?(d(),y(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:r(()=>{var t;return[g(m((t=s.description.error)==null?void 0:t.message),1)]}),_:2},1024)):u("",!0)])]),l("div",Se,[e[17]||(e[17]=l("label",{for:"currency",class:"col-sm-3 col-form-label"},"Valuta",-1)),l("div",xe,[i(a(ie),{name:"currency",modelValue:a(o).currency,"onUpdate:modelValue":e[4]||(e[4]=t=>a(o).currency=t),optionLabel:"description",suggestions:V.value,forceSelection:"",fluid:"",minLength:"2",onComplete:O,placeholder:"Seleziona la valuta"},null,8,["modelValue","suggestions"]),(N=s.currency)!=null&&N.invalid?(d(),y(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:r(()=>{var t;return[g(m((t=s.currency.error)==null?void 0:t.message),1)]}),_:2},1024)):u("",!0)])]),l("div",Ce,[e[18]||(e[18]=l("label",{for:"openDate",class:"col-sm-3 col-form-label"},"Data apertura",-1)),l("div",Fe,[i(a(R),{name:"openDate",fluid:"",modelValue:a(o).openDate,"onUpdate:modelValue":e[5]||(e[5]=t=>a(o).openDate=t),dateFormat:a(p).options.dateFormat,id:"opendate",placeholder:"Inserisci la data di apertura"},null,8,["modelValue","dateFormat"]),(B=s.openDate)!=null&&B.invalid?(d(),y(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:r(()=>{var t;return[g(m((t=s.openDate.error)==null?void 0:t.message),1)]}),_:2},1024)):u("",!0)])]),l("div",Ee,[e[19]||(e[19]=l("label",{for:"closedDate",class:"col-sm-3 col-form-label"},"Data chiusura",-1)),l("div",ze,[i(a(R),{name:"closedDate",fluid:"",modelValue:a(o).closedDate,"onUpdate:modelValue":e[6]||(e[6]=t=>a(o).closedDate=t),dateFormat:a(p).options.dateFormat,id:"closedDate",placeholder:"Inserisci la data di chiusura"},null,8,["modelValue","dateFormat"]),(U=s.closedDate)!=null&&U.invalid?(d(),y(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:r(()=>{var t;return[g(m((t=s.closedDate.error)==null?void 0:t.message),1)]}),_:2},1024)):u("",!0)])]),l("div",Te,[e[20]||(e[20]=l("label",{for:"initialbalance",class:"col-sm-3 col-form-label"},"Saldo iniziale",-1)),l("div",Ne,[i(a(te),{modelValue:a(o).initialBalance,"onUpdate:modelValue":e[7]||(e[7]=t=>a(o).initialBalance=t),min:0,step:.01,useGrouping:!0,minFractionDigits:2,maxFractionDigits:2,mode:"currency",currency:a(o).currency!=null&&a(o).currency!=""?a(o).currency.code:"EUR",locale:"it-IT",showButtons:"",class:"w-100"},null,8,["modelValue","currency"]),(h=s.initialBalance)!=null&&h.invalid?(d(),y(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:r(()=>{var t;return[g(m((t=s.type.initialBalance)==null?void 0:t.message),1)]}),_:2},1024)):u("",!0)])])]}),_:1},512)])])])])]),i(a(se),{header:"Crea account",visible:a(v),"onUpdate:visible":e[10]||(e[10]=s=>A(v)?v.value=s:v=s),modal:!0,closable:!0,style:{width:"50rem"}},{default:r(()=>[i(le,{ref_key:"createForm",ref:x},null,512),l("div",Be,[i(a(_),{type:"button",label:"Cancel",severity:"secondary",onClick:e[8]||(e[8]=s=>A(v)?v.value=!1:v=!1)}),i(a(_),{type:"button",label:"Save",class:"bg-gray-800 text-white border-none hover:bg-gray-800",onClick:e[9]||(e[9]=s=>K())})])]),_:1},8,["visible"])])):u("",!0),a(n).edititem==null&&!a(p).loading?(d(),D("div",Ue,[i(ee,{backaction:/accounts/})])):u("",!0)],64)}}};export{Pe as default};
