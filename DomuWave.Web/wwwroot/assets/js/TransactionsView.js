import{_ as rt,r as c,f as it,g as ut,p as R,s as N,h as dt,G as ct,c as D,i as s,d as a,w as i,a as I,b as n,t as m,e as F,F as ft,j as mt,k as j,H as pt,m as B,o as V,n as _,E as u}from"./app.js";import{u as gt}from"./accountStore.js";import{u as vt,a as yt,b as P,c as Ft,_ as bt}from"./index9.js";import{s as Dt}from"./Error404.js";import{s as Vt}from"./index2.js";import{s as p}from"./index3.js";import{s as O}from"./index5.js";import{a as Tt,s as wt}from"./index.js";import{s as q}from"./index11.js";import{a as E}from"./index6.js";import{S as g}from"./SortField.js";import"./accountApi.js";import"./index4.js";import"./systemApi.js";import"./index7.js";import"./index10.js";const xt={class:"container-fluid mt-4"},Ct={class:"row mb-3"},It={class:"col-sm-9"},_t={class:"row mb-3"},St={class:"col-sm-9"},kt={class:"row mb-3"},zt={class:"col-sm-9"},Ut={class:"row mb-3"},$t={class:"col-sm-9"},Lt={class:"row mb-3"},At={class:"col-sm-9"},Rt={key:0,class:"row mb-3"},Nt={class:"col-sm-9"},jt={class:"row mb-3"},Bt={class:"col-sm-9"},Pt={class:"row mb-3"},Ot={class:"col-sm-9"},qt={class:"row mb-3"},Et={class:"col-sm-9"},Mt={class:"card"},ht={class:"flex items-center gap-2"},Gt={class:"card shadow mb-4"},Ht={class:"card-header d-flex justify-content-between align-items-center"},Kt={class:"d-flex justify-content-end align-items-center gap-3"},Wt={class:"card-body"},Jt={class:"table-responsive"},Qt={class:"table table-bordered table-striped",id:"dataTable",width:"100%",cellspacing:"0"},Xt={class:"wp-5"},Yt={class:"text-muted wp-25"},Zt={class:"text-muted wp-25"},te={class:"text-muted wp-200"},ee={class:"text-muted wp-200"},le={class:"text-muted wp-200"},ae={class:"text-muted wp-35"},ne={class:"text-muted wp-100"},oe=["title"],se=["href"],re={key:0},ie=["href"],ue={key:0},de={class:"card-header d-flex justify-content-between align-items-center"},ce={class:"d-flex justify-content-end align-items-center gap-3"},fe={style:{display:"flex","justify-content":"flex-end",gap:"0.5rem","margin-top":"1rem"}},me={__name:"TransactionsView",props:{Transactionid:Number},setup(M){const h=ct(),G=pt(),e=vt(),H=gt();var d=c(!1);c([]);const x=c(!1);c(null),c(null);const r=c({field:"ValidFrom",direction:"asc"}),S=c(null),T=it(),K=ut(),W=M;c(null),c(null);const J=[{label:"Deposito",value:"e"},{label:"Uscita",value:"u"},{label:"Trasferimento",value:"t"}],Q=[{label:"Entrata",value:"i"},{label:"Uscita",value:"o"}];function X(){x.value=!x.value}const Y={1:"bg-danger text-white",0:"bg-success text-white",2:"bg-dark text-white"},Z={0:"fa fa-arrow-down",16:"fa fa-arrow-up",30:"fas fa-exchange-alt text-success",32:"fas fa-exchange-alt text-danger"},tt={0:"Entrata",16:"Uscita",30:"Trasferimento in entrata",32:"Trasferimento in uscita"};function et(o){var v;const t=new Map;for(const l of o)t.set(l.id,{key:l.id,label:l.name,data:l,children:[]});const b=[];for(const l of o){const y=t.get(l.id),w=((v=l.parent)==null?void 0:v.id)??null;w&&t.has(w)?t.get(w).children.push(y):b.push(y)}return b}const k=R({get(){const o=e.currentFilter.categoryId;return o!=null?{[o]:!0}:null},set(o){console.log("NEWVVV",o),e.currentFilter.categoryId=o?parseInt(Object.keys(o)[0]):null}});N(()=>e.currentFilter.transactionType,o=>{o!=null&&o!="t"&&(e.currentFilter.flowDirection=null)});const lt=R(()=>{console.log("TreeCS");let o=e.filterLookups.categories;var t=et(o);return t});async function at(o){T.startLoading(),console.log("e",e),await e.deleteTransaction(o),T.stopLoading()}const nt=(o,t)=>{K.require({target:o.currentTarget,message:"Sei sicuro di voler procedere con la cancellazione del tasso di cambio selezionato?",icon:"fas fa-exclamation-triangle yellow",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Cancella",class:"bg-danger"},accept:async()=>{await at(t)},reject:()=>{}})};async function z(){e.currentFilter.accountId!=null&&e.currentFilter.accountId,e.currentFilter.categoryId!=null&&e.currentFilter.categoryId,e.currentFilter.fromDate!=null&&e.currentFilter.fromDate,e.currentFilter.toDate!=null&&e.currentFilter.toDate,e.currentFilter.transactionType!=null&&e.currentFilter.transactionType,e.currentFilter.flowDirection!=null&&e.currentFilter.flowDirection,e.currentFilter.status!=null&&e.currentFilter.status,e.currentFilter.note!=null&&e.currentFilter.note;const o={accountId:e.currentFilter.accountId||void 0,categoryId:e.currentFilter.categoryId||void 0,fromDate:e.currentFilter.fromDate?e.currentFilter.fromDate.toISOString().split("T")[0]:void 0,toDate:e.currentFilter.toDate?e.currentFilter.toDate.toISOString().split("T")[0]:void 0,transactionType:e.currentFilter.transactionType||void 0,flowDirection:e.currentFilter.flowDirection||void 0,status:e.currentFilter.status||void 0,note:e.currentFilter.note||void 0,sortBy:r.value.field||void 0,sortOrder:r.value.direction||void 0,currentPage:e.page||void 0};console.log("Aggiorna la query string senza ricaricare la pagina",o),G.replace({query:o})}async function U(){T.startLoading(),await z();var o=e.currentFilter.accountId!=null?e.currentFilter.accountId:null,t=e.currentFilter.categoryId!=null?e.currentFilter.categoryId:null,b=e.currentFilter.fromDate!=null?e.currentFilter.fromDate:null,v=e.currentFilter.toDate!=null?e.currentFilter.toDate:null,l=e.currentFilter.transactionType!=null?e.currentFilter.transactionType:null,y=e.currentFilter.flowDirection!=null?e.currentFilter.flowDirection:null,w=e.currentFilter.status!=null?e.currentFilter.status:null,st=e.currentFilter.note!=null?e.currentFilter.note:null;await e.filterAlltransaction(null,o,t,b,v,l,y,w,st,r.value.field,r.value.direction,e.page),T.stopLoading()}async function f(o){r.value=o,await C()}async function C(){T.startLoading(),await e.loadFilterLookups(),await H.loadLookups(),await U()}dt(async()=>{console.log("CategoryId iniziale:",e.currentFilter.categoryId),e.currentFilter.accountId=null;const o=h.query;e.currentFilter.accountId=o.accountId?parseInt(o.accountId):null,e.currentFilter.categoryId=o.categoryId?parseInt(o.categoryId):null,e.currentFilter.fromDate=o.fromDate?new Date(o.fromDate):null,e.currentFilter.toDate=o.toDate?new Date(o.toDate):null,e.currentFilter.transactionType=o.transactionType||null,e.currentFilter.flowDirection=o.flowDirection||null,e.currentFilter.status=o.status?parseInt(o.status):null,e.currentFilter.note=o.note||null,e.page=o.currentPage?parseInt(o.currentPage):1,r.value.field=o.sortBy||"TransactionDate",r.value.direction=o.sortOrder||"desc",await C(),console.log("CategoryId iniziale 22:",e.currentFilter.categoryId)}),N(()=>W.Transactionid,o=>{o!=null&&(o!=0?$(o):L())},{immediate:!0});async function $(o){await e.edit(o),d.value=!0}function L(){e.newEntity(),d.value=!0}async function A(o){e.onPageChange(o.page+1),await z()}async function ot(){await S.value.submitForm()&&setTimeout(async function(){await C(),d.value=!1},500)}return(o,t)=>{const b=B("date"),v=B("currency");return V(),D("div",null,[s(n(Ft),{visible:x.value,"onUpdate:visible":t[9]||(t[9]=l=>x.value=l),position:"right",modal:!0,style:{width:"30rem"}},{default:i(()=>[t[33]||(t[33]=a("h2",{class:"mb-4"},"Specificare i filtri",-1)),a("p",null,[a("div",xt,[a("div",Ct,[t[23]||(t[23]=a("label",{for:"account",class:"col-sm-3 col-form-label"},"Account",-1)),a("div",It,[s(n(O),{name:"account",modelValue:n(e).currentFilter.accountId,"onUpdate:modelValue":t[0]||(t[0]=l=>n(e).currentFilter.accountId=l),options:n(e).filterLookups.accounts,optionLabel:"name",optionValue:"id",placeholder:"Seleziona l''account",class:"w-full"},null,8,["modelValue","options"])])]),a("div",_t,[t[24]||(t[24]=a("label",{for:"category",class:"col-sm-3 col-form-label"},"Categoria",-1)),a("div",St,[s(n(yt),{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=l=>k.value=l),options:lt.value,placeholder:"Seleziona categoria",class:"w-full treeselect-fixed",showClear:"true"},null,8,["modelValue","options"])])]),a("div",kt,[t[25]||(t[25]=a("label",{for:"filterFromDate",class:"col-sm-3 col-form-label"},"Data Da",-1)),a("div",zt,[s(n(E),{id:"filterFromDate",modelValue:n(e).currentFilter.fromDate,"onUpdate:modelValue":t[2]||(t[2]=l=>n(e).currentFilter.fromDate=l),maxDate:n(e).currentFilter.toDate,dateFormat:"dd/mm/yy",placeholder:"Seleziona un intervallo",showIcon:"",class:"w-full"},null,8,["modelValue","maxDate"])])]),a("div",Ut,[t[26]||(t[26]=a("label",{for:"filterToDate",class:"col-sm-3 col-form-label"},"Data A",-1)),a("div",$t,[s(n(E),{id:"filterToDate",modelValue:n(e).currentFilter.toDate,"onUpdate:modelValue":t[3]||(t[3]=l=>n(e).currentFilter.toDate=l),minDate:n(e).currentFilter.fromDate,dateFormat:"dd/mm/yy",placeholder:"Seleziona un intervallo",showIcon:"",class:"w-full"},null,8,["modelValue","minDate"])])]),a("div",Lt,[t[27]||(t[27]=a("label",{for:"filterTransactionType",class:"col-sm-3 col-form-label"},"Tipo",-1)),a("div",At,[s(n(P),{modelValue:n(e).currentFilter.transactionType,"onUpdate:modelValue":t[4]||(t[4]=l=>n(e).currentFilter.transactionType=l),options:J,optionLabel:"label",optionValue:"value",placeholder:"Seleziona un'opzione",showClear:"",class:"w-full"},null,8,["modelValue"])])]),n(e).currentFilter.transactionType!=null&&n(e).currentFilter.transactionType=="t"?(V(),D("div",Rt,[t[28]||(t[28]=a("label",{for:"filterFlowDirection",class:"col-sm-3 col-form-label"},"Flusso",-1)),a("div",Nt,[s(n(P),{modelValue:n(e).currentFilter.flowDirection,"onUpdate:modelValue":t[5]||(t[5]=l=>n(e).currentFilter.flowDirection=l),options:Q,optionLabel:"label",optionValue:"value",placeholder:"Seleziona un'opzione",showClear:"",class:"w-full"},null,8,["modelValue"])])])):I("",!0),a("div",jt,[t[29]||(t[29]=a("label",{for:"status",class:"col-sm-3 col-form-label"},"Stato",-1)),a("div",Bt,[s(n(O),{name:"status",modelValue:n(e).currentFilter.status,"onUpdate:modelValue":t[6]||(t[6]=l=>n(e).currentFilter.status=l),options:n(e).filterLookups.statuses,optionLabel:"description",optionValue:"id",placeholder:"Seleziona lo stato",class:"w-full"},null,8,["modelValue","options"])])]),a("div",Pt,[t[30]||(t[30]=a("label",{for:"note",class:"col-sm-3 col-form-label"},"Note",-1)),a("div",Ot,[s(n(Tt),{name:"note",modelValue:n(e).currentFilter.note,"onUpdate:modelValue":t[7]||(t[7]=l=>n(e).currentFilter.note=l),placeholder:"Cerca nel campo note",class:"w-full"},null,8,["modelValue"])])]),a("div",qt,[t[32]||(t[32]=a("label",{for:"account",class:"col-sm-3 col-form-label"},null,-1)),a("div",Et,[s(n(p),{as:"a",label:"Filtra",text:"",plain:"",onClick:t[8]||(t[8]=l=>U())},{default:i(()=>t[31]||(t[31]=[a("i",{class:"fa fa-filter"},null,-1)])),_:1,__:[31]})])])])])]),_:1,__:[33]},8,["visible"]),a("div",Mt,[s(n(Dt),{style:{padding:"1rem 1rem 1rem 1.5rem"}},{start:i(()=>t[34]||(t[34]=[a("h1",{class:"h3 mb-0 text-gray-800"},"Transazioni",-1)])),center:i(()=>t[35]||(t[35]=[])),end:i(()=>[a("div",ht,[s(n(p),{label:"Refresh",text:"",plain:"",onClick:C},{default:i(()=>t[36]||(t[36]=[a("i",{class:"fas fa-sync-alt"},null,-1)])),_:1,__:[36]}),s(n(p),{as:"a",label:"Crea",text:"",plain:"",onClick:t[10]||(t[10]=l=>L())},{default:i(()=>t[37]||(t[37]=[a("i",{class:"fa fa-plus-square"},null,-1)])),_:1,__:[37]}),s(n(p),{as:"a",label:"Filtri",text:"",plain:"",onClick:t[11]||(t[11]=l=>X())},{default:i(()=>t[38]||(t[38]=[a("i",{class:"fa fa-filter"},null,-1)])),_:1,__:[38]})])]),_:1})]),a("div",Gt,[a("div",Ht,[t[39]||(t[39]=a("div",{class:"d-flex align-items-center gap-2"},null,-1)),a("div",Kt,[a("span",null,"Totale: "+m(n(e).totalRecords),1),s(n(q),{rows:n(e).pageSize,totalRecords:n(e).totalRecords,first:(n(e).page-1)*n(e).pageSize,onPage:A},null,8,["rows","totalRecords","first"])])]),a("div",Wt,[a("div",Jt,[s(n(Vt)),a("table",Qt,[a("thead",null,[a("tr",null,[a("th",Xt,[s(g,{modelValue:r.value,"onUpdate:modelValue":[t[12]||(t[12]=l=>r.value=l),f],field:"TransactionType"},null,8,["modelValue"])]),a("th",Yt,[s(g,{modelValue:r.value,"onUpdate:modelValue":[t[13]||(t[13]=l=>r.value=l),f],field:"TransactionDate"},{default:i(()=>t[40]||(t[40]=[F(" Data ")])),_:1,__:[40]},8,["modelValue"])]),a("th",Zt,[s(g,{modelValue:r.value,"onUpdate:modelValue":[t[14]||(t[14]=l=>r.value=l),f],field:"status"},{default:i(()=>t[41]||(t[41]=[F(" Stato ")])),_:1,__:[41]},8,["modelValue"])]),a("th",te,[s(g,{modelValue:r.value,"onUpdate:modelValue":[t[15]||(t[15]=l=>r.value=l),f],field:"Account"},{default:i(()=>t[42]||(t[42]=[F(" Account ")])),_:1,__:[42]},8,["modelValue"])]),a("th",ee,[s(g,{modelValue:r.value,"onUpdate:modelValue":[t[16]||(t[16]=l=>r.value=l),f],field:"Beneficiary"},{default:i(()=>t[43]||(t[43]=[F(" Beneficiario ")])),_:1,__:[43]},8,["modelValue"])]),a("th",le,[s(g,{modelValue:r.value,"onUpdate:modelValue":[t[17]||(t[17]=l=>r.value=l),f],field:"Category"},{default:i(()=>t[44]||(t[44]=[F(" Categoria ")])),_:1,__:[44]},8,["modelValue"])]),a("th",ae,[s(g,{modelValue:r.value,"onUpdate:modelValue":[t[18]||(t[18]=l=>r.value=l),f],field:"AmountInAccountCurrency"},{default:i(()=>t[45]||(t[45]=[F(" Importo ")])),_:1,__:[45]},8,["modelValue"])]),t[47]||(t[47]=a("th",{class:"text-muted wp-35"}," Saldo ",-1)),a("th",ne,[s(g,{modelValue:r.value,"onUpdate:modelValue":[t[19]||(t[19]=l=>r.value=l),f],field:"Note"},{default:i(()=>t[46]||(t[46]=[F(" Note ")])),_:1,__:[46]},8,["modelValue"])]),t[48]||(t[48]=a("th",null,null,-1))])]),a("tbody",null,[(V(!0),D(ft,null,mt(n(e).transactions,l=>(V(),D("tr",{key:l.id},[a("td",{class:u(["text-start align-middle",Y[l.transactionType]]),title:tt[l.transactionType*(l.flowDirection+15)]},[a("i",{class:u(Z[l.transactionType*(l.flowDirection+15)])},null,2)],10,oe),_(a("td",{class:u(["text-start align-middle",l.status.cssClass])},null,2),[[b,l.transactionDate,"date"]]),a("td",{class:u(["text-start align-middle",l.status.cssClass])},m(l.status.description),3),a("td",{class:u(["text-start align-middle",l.status.cssClass])},[a("a",{href:`/accounts/${l.account.id}/transactions`,target:"_blank"},m(l.account.code),9,se),l.destinationAccount!=null&&l.transactionType==2?(V(),D("div",re,[a("i",{class:u({"fa fa-arrow-right":l.flowDirection==1,"fa fa-arrow-left":l.flowDirection==0})},null,2),a("a",{href:`/accounts/${l.destinationAccount.id}/transactions`,target:"_blank"},m(l.destinationAccount.code),9,ie)])):I("",!0)],2),a("td",{class:u(["text-start align-middle",l.status.cssClass])},m(l.beneficiary.description),3),a("td",{class:u(["text-start align-middle",l.status.cssClass])},m(l.category.description),3),_(a("td",{class:u(["text-start align-middle",l.status.cssClass])},null,2),[[v,{amount:l.amountInAccountCurrency,locale:"it-IT",currency:l.accountCurrency.code}]]),_(a("td",{class:u(["text-start align-middle",l.status.cssClass])},null,2),[[v,{amount:l.accountBalance,locale:"it-IT",currency:l.accountCurrency.code}]]),a("td",{class:u(["text-start align-middle",l.status.cssClass])},m(l.description),3),a("td",{class:u(["text-start align-middle",l.status.cssClass])},[s(n(p),{onClick:y=>$(l.id),label:"Modifica",severity:"default",outlined:""},{default:i(()=>t[49]||(t[49]=[a("i",{class:"far fa-edit"},null,-1)])),_:2,__:[49]},1032,["onClick"]),s(n(p),{onClick:y=>nt(y,l.id),label:"Delete",severity:"danger",outlined:""},{default:i(()=>t[50]||(t[50]=[a("i",{class:"far fa-minus-square"},null,-1)])),_:2,__:[50]},1032,["onClick"])],2)]))),128)),n(e).Transaction!=null&&n(e).Transaction.length===0?(V(),D("tr",ue,t[51]||(t[51]=[a("td",{colspan:"4",class:"text-center text-muted fst-italic py-3"}," Nessuna transazione trovata ",-1)]))):I("",!0)])])])]),a("div",de,[t[52]||(t[52]=a("div",{class:"d-flex align-items-center gap-2"},null,-1)),a("div",ce,[a("span",null,"Totale: "+m(n(e).totalRecords),1),s(n(q),{rows:n(e).pageSize,totalRecords:n(e).totalRecords,first:(n(e).page-1)*n(e).pageSize,onPage:A},null,8,["rows","totalRecords","first"])])])]),s(n(wt),{header:"Transazione",visible:n(d),"onUpdate:visible":t[22]||(t[22]=l=>j(d)?d.value=l:d=l),modal:!0,closable:!0,style:{width:"50rem"}},{default:i(()=>[s(bt,{ref_key:"editForm",ref:S},null,512),a("div",fe,[s(n(p),{type:"button",label:"Cancel",severity:"secondary",onClick:t[20]||(t[20]=l=>j(d)?d.value=!1:d=!1)}),s(n(p),{type:"button",label:"Save",class:"bg-gray-800 text-white border-none hover:bg-gray-800",onClick:t[21]||(t[21]=l=>ot())})])]),_:1},8,["visible"])])}}},ze=rt(me,[["__scopeId","data-v-1ca13288"]]);export{ze as default};
