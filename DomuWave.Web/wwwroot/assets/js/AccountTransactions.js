import{r as y,v as $e,f as Re,h as Ae,p as Q,s as X,l as Ue,c as E,o as b,d as a,i as u,w as m,x,a as D,b as t,e as T,t as g,_ as Be,g as qe,G as Pe,F as Se,j as Ne,k as ce,H as Oe,m as Ie,I as we,E as C,n as Fe}from"./app.js";import{u as he}from"./accountStore.js";import{u as Me,t as Te,s as je,a as Ke,b as xe,c as Ge,_ as He}from"./index9.js";import{s as We}from"./Error404.js";import{s as Je}from"./index2.js";import{s as S}from"./index3.js";import{s as W,a as Qe}from"./index5.js";import{A as Xe}from"./AccountTabber.js";import{a as _e,s as De}from"./index6.js";import{s as R}from"./index10.js";import{a as Ee,b as Ye,s as ke}from"./index.js";import{s as ze}from"./index11.js";import{S as N}from"./SortField.js";import"./accountApi.js";import"./index4.js";import"./systemApi.js";import"./index7.js";import"./index8.js";const Ze={class:"card shadow mb-4"},et={class:"card-body"},tt={class:"container-fluid mt-4"},lt={class:"row"},at={class:"col-md-6"},nt={class:"mb-3"},ot={class:"d-flex align-items-center gap-2"},st={class:"col-md-6"},it={class:"mb-3"},rt={class:"d-flex align-items-center gap-2"},ut={class:"row"},ct={class:"col-md-6"},dt={class:"mb-3"},mt={class:"d-flex align-items-center gap-2"},ft={class:"row mb-3"},pt={class:"col-md-6"},vt={class:"mb-3"},yt={class:"d-flex align-items-center gap-2"},gt={class:"col-md-6"},bt={key:0,class:"mb-3"},Vt={class:"d-flex align-items-center gap-2"},wt={class:"row mb-3"},Ft={class:"col-md-6"},Tt={class:"mb-3"},Dt={class:"d-flex align-items-center gap-2"},_t={class:"col-md-6"},Ct={class:"mb-3"},St={class:"d-flex align-items-center gap-2"},It={class:"row mb-3"},xt={class:"col-md-6"},kt={class:"mb-3"},zt={class:"d-flex align-items-center gap-2"},$t={class:"flex items-center"},Rt={class:"col-md-6"},At={class:"mb-3"},Ut={class:"d-flex align-items-center gap-2"},ht={class:"flex items-center"},Mt={class:"row"},Et={class:"col-md-6"},Lt={class:"mb-3"},Bt={class:"d-flex align-items-center gap-2"},qt={class:"col-md-6"},Pt={class:"mb-3"},Nt={class:"d-flex align-items-center gap-2"},Ot={class:"row"},jt={class:"col-md-12"},Kt={class:"mb-3"},Gt={class:"d-flex align-items-center gap-2"},Ht={__name:"TransactionMassiveEditForm",setup(Ce,{expose:de}){var oe=y(!1);const O=y([]),B=y([]),q=y([]),j=async c=>{console.log("Carico le valute",c.query),O.value=await K.loadCurrencies(c.query),console.log("Ho caricato le valute:",O)},o=async c=>{var n=await V.findBeneficiaries(c.query);console.log("find",c.query,n),(n==null||n.length==0)&&(n=[{name:" "+c.query,description:" "+c.query,id:22}]),console.log("find 2",n),B.value=n,console.log(B.value)},A=async c=>{var n=await V.findCategories(c.query);console.log("find category",c.query,n),q.value=n},V=Me(),w=he(),k=$e(),K=Re();var e=y({...V.massiveEditItem});const G=y(null),P=y(null),Y=y(!1);console.log("editEntity ",e);const U=({values:c})=>{console.log("RESOLVER",c);const n={};return console.log("editEntity.value.transactionType",e.value.transactionType),e.updateTransactionType&&(e.value.transactionType==null||e.value.transactionType=="")&&e.value.transactionType!=0&&(n.transactionType=[{message:"Specificare il tipo"}]),e.updateAccountId&&e.value.account==null&&(n.currency=[{message:"Selezionare l'account"}]),e.updateTransactionType&&e.value.transactionType==2&&e.value.destinationAccount==null&&(n.accountTo=[{message:"Specificare l'account di destinazione"}]),e.updatePaymentMethodId&&e.value.paymentMethod==null&&(n.paymentmethod=[{message:"Selezionare il metodo di pagamento."}]),e.updateCurrencyId&&e.value.currency==null&&(n.currency=[{message:"Selezionare la valuta di riferimento."}]),console.log("editEntity.value.validFrom ",e.value.transactionDate),e.updateTransactionDate&&(e.value.transactionDate==null||e.value.transactionDate=="")&&(n.transactionDate=[{message:"Selezionare la data di riferimento."}]),{errors:n}};console.log("onFormSubmit pre");async function me(){return new Promise(async c=>{P.value?(G.value=c,await P.value.submit()):c(!1)})}const H=async({valid:c})=>{let n=!1;if(Y.value=!0,c){oe.value=!0;try{await V.saveMassive(e.value),n=!0}catch(f){console.error("Errore nel salvataggio:",f),k.showError("Errore durante il salvataggio del cambio valuta."),n=!1}finally{oe.value=!1}}G.value&&(console.log("onFormSubmit resolve",n),G.value(n),console.log("onFormSubmit resolve 2",n),G.value=null)};console.log("onFormSubmit after");async function fe(){if(e!=null&&e.value!=null){var c=e.value.account;if(c!=null){var n=await V.getPaymentMethods(c.id);V.filterLookups.paymentMethods=Te(n.map(f=>f.paymentMethod))}}}async function se(c){if(c!=null){console.log("CCC",c),console.log("CCC editEntity.beneficiary",e);var n=c.value;console.log("BBBB",n),n!=null?(e.value.beneficiary=n,e.value.beneficiaryId=n.id,n.category!=null,e.value.category=n.category):(e.value.beneficiary=null,e.value.beneficiaryId=null)}}async function ie(c){if(c!=null){var n=c.value;console.log("BBBB",n.value),n!=null?e.value.category=n:e.value.category=null}}async function pe(c){const n=w.accounts.find(p=>p.id===c.value.id);if(n!=null){var f=e!=null&&e.value!=null?e.value.account:null;console.log("fromAccount: ",f);const p=f!=null?w.accounts.find(F=>F.id===f.id):null;if(console.log("fromRawAccount: ",p),e.value.currency=n.currency,p!=null){var d=await V.getRate(p.currency,n.currency,e.value.transactionDate);d!=null?e.value.rate=d.rate:e.value.rate=null}}}async function ve(){e.value.transactionType!=null&&e.value.transactionType!=2&&(e.value.destinationAccount=null);var c=e!=null&&e.value!=null?e.account:null,n=e!=null&&e.value!=null?e.value.destinationAccount:null;if(n!=null){const d=w.accounts.find(F=>F.id===n.id),p=c!=null?w.accounts.find(F=>F.id===c.id):null;if(e.value.currency=d.currency,p!=null){var f=await V.getRate(p.currency,d.currency,e.value.transactionDate);f!=null?e.value.rate=f.rate:e.value.rate=null}}}async function ye(c){const n=w.accounts.find(F=>F.id===c.value.id);if(n!=null){var f=await V.getPaymentMethods(n.id);if(V.filterLookups.paymentMethods=Te(f.map(F=>F.paymentMethod)),console.log("isTrasfer",h.value),!h.value)console.log("editEntity.value.currency",e.value.currency),e.value.currency=n.currency,console.log("editEntity.value.currency new",e.value.currency),e.value.rate=1;else{var d=e!=null&&e.value!=null?e.destinationAccount:null;if(d!=null){const F=w.accounts.find(J=>J.id===d.id);console.log("onaccountchange call getrate",n.currency,F,e.value.transactionDate);var p=await V.getRate(n.currency,F.currency,e.value.transactionDate);p!=null?e.value.rate=p.rate:e.value.rate=null}}}}async function ge(c){var n=e.value!=null?e.value.currency:null,f=e.value!=null?e.value.account.currency:null;if(n!=null){var d=await V.getRate(f,n,c);d!=null?e.value.rate=d.rate:e.value.rate=null}else e.value.rate=null}async function Z(c){if(c!=null&&c.value!=null){var n=e.value!=null&&e.value.account!=null?e.value.account.currency:null;if(e.value!=null&&e.value.account==null)return;if(n==null){console.log("accountCurrency certo rawacc",e.value.account.id);var f=w.accounts.find(p=>p.id===e.value.account.id);console.log("accountCurrency certo rawacc",f),n=f.currency}console.log("accountCurrency ",n),console.log("accountCurrency evt.value",c.value);var d=await V.getRate(n,c.value,e.value.transactionDate);d!=null?e.value.rate=d.rate:e.value.rate=null}else e.value.rate=null}Ae(async()=>{await fe()}),de({submitForm:me});const re=Q(()=>Te(w.accounts)),h=Q(()=>e!=null&&e.value.transactionType!=null&&e.value.transactionType==2),be=Q(()=>{console.log("enableCurrency");var c=e!=null&&e.value!=null&&e.value.currency!=null&&e.value.currency!=""&&!h.value;return console.log("enableCurrency",c),c}),Ve=Q(()=>{var c=null,n=null;if(console.log("Enable RATE ",e.rate),e.rate==null)return!0;e!=null&&e.value!=null&&e.value.account!=null&&(c=w.accounts.find(F=>F.id===e.value.account.id)),h&&e!=null&&e.value!=null&&e.value.destinationAccount!=null&&(n=w.accounts.find(F=>F.id===e.value.destinationAccount.id));var f=!1;console.log("enableRate fromAccount",c),console.log("enableRate toAccount",n),c=c!=null&&c.value!=null?c.value:c,n=n!=null&&n.value!=null?n.value:n,console.log("enableRate",c,n),console.log("enableRate c",c!=null?c.currency:null,n!=null?n.currency:null);var d=c!=null?c.currency:null,p=n!=null?n.currency:null;return d==null||h.value&&p==null?(console.log("enableRate currencyFrom",d),console.log("enableRate isTransfer",h.value),!1):(!h.value&&e.value.currency!=null&&(p=e.value.currency),f=d.id!=p.id||e.rate==null,console.log("enableRate result:",f),console.log("enableRate editEntity.rate:",e.rate),f)});return X(e,async()=>{Y.value&&P.value&&await P.value.validate()},{deep:!0}),X(()=>V.edititem,c=>{c!=null&&(e.value={...V.edititem})},{immediate:!0}),(c,n)=>{const f=Ue("Message");return b(),E("div",null,[a("div",Ze,[a("div",et,[a("div",tt,[a("div",null,[u(t(Ye),{ref_key:"formRef",ref:P,resolver:U,onSubmit:H,class:"flex flex-col gap-4 w-full sm:w-56 mt-2 ml-2"},{default:m(d=>{var p,F,J,ue,ee,te,z,L,le,ae,ne;return[a("div",lt,[a("div",at,[a("div",nt,[n[23]||(n[23]=a("label",{for:"transactionDate",class:"col-form-label"}," Data ",-1)),a("div",ot,[u(t(R),{modelValue:t(e).updateTransactionDate,"onUpdate:modelValue":n[0]||(n[0]=i=>t(e).updateTransactionDate=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(_e),{name:"transactionDate",fluid:"",modelValue:t(e).transactionDate,"onUpdate:modelValue":[n[1]||(n[1]=i=>t(e).transactionDate=i),ge],disabled:!t(e).updateTransactionDate,dateFormat:t(K).options.dateFormat,placeholder:"Seleziona la data",class:"w-100"},null,8,["modelValue","disabled","dateFormat"]),(p=d.transactionDate)!=null&&p.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.transactionDate.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])]),a("div",st,[a("div",it,[n[24]||(n[24]=a("label",{for:"status",class:"col-form-label"},"Stato",-1)),a("div",rt,[u(t(R),{modelValue:t(e).updateStatus,"onUpdate:modelValue":n[2]||(n[2]=i=>t(e).updateStatus=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(W),{name:"status",disabled:!t(e).updateStatus,modelValue:t(e).status,"onUpdate:modelValue":n[3]||(n[3]=i=>t(e).status=i),options:t(V).filterLookups.statuses,optionLabel:"description",placeholder:"Seleziona lo stato",class:"w-100"},null,8,["disabled","modelValue","options"]),(F=d.status)!=null&&F.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.status.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])])]),a("div",ut,[a("div",ct,[a("div",dt,[n[25]||(n[25]=a("label",{for:"transactionType",class:"col-form-label"},"Tipo",-1)),a("div",mt,[u(t(R),{modelValue:t(e).updateTransactionType,"onUpdate:modelValue":n[4]||(n[4]=i=>t(e).updateTransactionType=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(W),{name:"transactionType",modelValue:t(e).transactionType,"onUpdate:modelValue":n[5]||(n[5]=i=>t(e).transactionType=i),options:t(V).filterLookups.transactionTypes,optionLabel:"description",disabled:!t(e).updateTransactionType,optionValue:"id",placeholder:"Seleziona il tipo",onChange:ve,class:"w-100"},null,8,["modelValue","options","disabled"]),(J=d.transactionType)!=null&&J.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.transactionType.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])])]),a("div",ft,[a("div",pt,[a("div",vt,[n[26]||(n[26]=a("label",{for:"account",class:"col-form-label"},"Account",-1)),a("div",yt,[u(t(R),{modelValue:t(e).updateAccountId,"onUpdate:modelValue":n[6]||(n[6]=i=>t(e).updateAccountId=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(W),{name:"account",modelValue:t(e).account,"onUpdate:modelValue":n[7]||(n[7]=i=>t(e).account=i),options:re.value,disabled:!t(e).updateAccountId,optionLabel:"code",placeholder:"Seleziona l'account",onChange:ye,class:"w-100"},null,8,["modelValue","options","disabled"]),(ue=d.account)!=null&&ue.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.account.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])]),a("div",gt,[h.value?(b(),E("div",bt,[n[27]||(n[27]=a("label",{for:"accountTo",class:"col-form-label"},"Account a",-1)),a("div",Vt,[u(t(R),{modelValue:t(e).updateDestinationAccountId,"onUpdate:modelValue":n[8]||(n[8]=i=>t(e).updateDestinationAccountId=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(W),{name:"accountTo",modelValue:t(e).destinationAccount,"onUpdate:modelValue":n[9]||(n[9]=i=>t(e).destinationAccount=i),options:re.value,optionLabel:"code",disabled:!t(e).updateDestinationAccountId,placeholder:"Seleziona l'account di destinazione",onChange:pe,class:"w-100"},null,8,["modelValue","options","disabled"]),(ee=d.accountTo)!=null&&ee.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.accountTo.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])):D("",!0)])]),a("div",wt,[a("div",Ft,[a("div",Tt,[n[28]||(n[28]=a("label",{for:"paymentmethod",class:"col-form-label"},"Metodo di pagamento",-1)),a("div",Dt,[u(t(R),{modelValue:t(e).updatePaymentMethodId,"onUpdate:modelValue":n[10]||(n[10]=i=>t(e).updatePaymentMethodId=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(W),{name:"paymentmethod",modelValue:t(e).paymentMethod,"onUpdate:modelValue":n[11]||(n[11]=i=>t(e).paymentMethod=i),options:t(V).filterLookups.paymentMethods,optionLabel:"description",disabled:!t(e).updatePaymentMethodId,placeholder:"Seleziona il metodo di pagamento",class:"w-100"},null,8,["modelValue","options","disabled"]),(te=d.paymentmethod)!=null&&te.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.paymentmethod.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])]),a("div",_t,[a("div",Ct,[n[29]||(n[29]=a("label",{for:"amount",class:"col-form-label"},"Importo",-1)),a("div",St,[u(t(R),{modelValue:t(e).updateAmount,"onUpdate:modelValue":n[12]||(n[12]=i=>t(e).updateAmount=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(Qe),{modelValue:t(e).amount,"onUpdate:modelValue":n[13]||(n[13]=i=>t(e).amount=i),min:0,disabled:!t(e).updateAmount,step:.01,useGrouping:!0,minFractionDigits:2,maxFractionDigits:2,mode:"currency",currency:t(e).currency!=null&&t(e).currency!=""?t(e).currency.code:"EUR",locale:"it-IT",showButtons:"",class:"w-100"},null,8,["modelValue","disabled","currency"]),(z=d.amount)!=null&&z.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.type.amount)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])])]),a("div",It,[a("div",xt,[a("div",kt,[n[30]||(n[30]=a("label",{for:"beneficiary",class:"col-form-label"},"Beneficiario",-1)),a("div",zt,[u(t(R),{modelValue:t(e).updateBeneficiary,"onUpdate:modelValue":n[14]||(n[14]=i=>t(e).updateBeneficiary=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(De),{name:"beneficiary",optionLabel:"description",modelValue:t(e).beneficiary,"onUpdate:modelValue":[n[15]||(n[15]=i=>t(e).beneficiary=i),se],suggestions:B.value,forceSelection:"false",fluid:"",minLength:"2",disabled:!t(e).updateBeneficiary,onItemSelect:se,onComplete:o,placeholder:"Seleziona il beneficiario",class:"w-100"},{option:m(i=>[a("div",$t,[a("div",null,g(i.option.description),1)])]),_:1},8,["modelValue","suggestions","disabled"]),(L=d.beneficiary)!=null&&L.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.beneficiary.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])]),a("div",Rt,[a("div",At,[n[31]||(n[31]=a("label",{for:"category",class:"col-form-label"},"Categoria",-1)),a("div",Ut,[u(t(R),{modelValue:t(e).updateCategoryId,"onUpdate:modelValue":n[16]||(n[16]=i=>t(e).updateCategoryId=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(De),{name:"category",optionLabel:"description",modelValue:t(e).category,"onUpdate:modelValue":[n[17]||(n[17]=i=>t(e).category=i),ie],suggestions:q.value,forceSelection:"false",fluid:"",minLength:"2",disabled:!t(e).updateCategoryId,onItemSelect:ie,onComplete:A,placeholder:"Seleziona la categoria",class:"w-100"},{option:m(i=>[a("div",ht,[a("div",null,g(i.option.description),1)])]),_:1},8,["modelValue","suggestions","disabled"]),(le=d.category)!=null&&le.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.category.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])])]),a("div",Mt,[a("div",Et,[a("div",Lt,[n[32]||(n[32]=a("label",{for:"name",class:"col-form-label"},"Valuta",-1)),a("div",Bt,[u(t(R),{modelValue:t(e).updateCurrencyId,"onUpdate:modelValue":n[18]||(n[18]=i=>t(e).updateCurrencyId=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(De),{name:"currency",optionLabel:"description",modelValue:t(e).currency,"onUpdate:modelValue":[n[19]||(n[19]=i=>t(e).currency=i),Z],suggestions:O.value,fluid:"",minLength:"2",disabled:!t(e).updateCurrencyId||!be.value,onItemSelect:Z,onComplete:j,placeholder:"Seleziona la valuta",class:"w-100"},null,8,["modelValue","suggestions","disabled"]),(ae=d.currency)!=null&&ae.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.currency.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])]),a("div",qt,[a("div",Pt,[n[33]||(n[33]=a("label",{for:"rate",class:"col-form-label"}," Tasso ",-1)),a("div",Nt,[u(t(Ee),{name:"rate",type:"number",disabled:!t(e).updateCurrencyId||!Ve.value,placeholder:"Specifica il tasso",fluid:"",modelValue:t(e).rate,"onUpdate:modelValue":n[20]||(n[20]=i=>t(e).rate=i),class:"w-100"},null,8,["disabled","modelValue"]),(ne=d.rate)!=null&&ne.invalid?(b(),x(f,{key:0,severity:"error",size:"small",variant:"simple"},{default:m(()=>{var i;return[T(g((i=d.rate.error)==null?void 0:i.message),1)]}),_:2},1024)):D("",!0)])])])]),a("div",Ot,[a("div",jt,[a("div",Kt,[n[34]||(n[34]=a("label",{for:"name",class:"col-form-label"},"Note",-1)),a("div",Gt,[u(t(R),{modelValue:t(e).updateDescription,"onUpdate:modelValue":n[21]||(n[21]=i=>t(e).updateDescription=i),binary:!0,inputId:"cb1"},null,8,["modelValue"]),u(t(je),{modelValue:t(e).description,"onUpdate:modelValue":n[22]||(n[22]=i=>t(e).description=i),rows:"5",cols:"30",class:"w-100",disabled:!t(e).updateDescription},null,8,["modelValue","disabled"])])])])])]}),_:1},512)])])])])])}}},Wt={key:0},Jt={class:"card"},Qt={class:"h3 mb-0 text-gray-800"},Xt={class:"flex items-center gap-2"},Yt={class:"card shadow mb-4"},Zt={class:"card-body"},el={class:"container-fluid mt-4"},tl={class:"row mb-3"},ll={class:"col-sm-9"},al={class:"row mb-3"},nl={class:"col-sm-9"},ol={class:"row mb-3"},sl={class:"col-sm-9"},il={class:"row mb-3"},rl={class:"col-sm-9"},ul={class:"row mb-3"},cl={class:"col-sm-9"},dl={key:0,class:"row mb-3"},ml={class:"col-sm-9"},fl={class:"row mb-3"},pl={class:"col-sm-9"},vl={class:"row mb-3"},yl={class:"col-sm-9"},gl={class:"row mb-3"},bl={class:"col-sm-9"},Vl={class:"card-header d-flex justify-content-between align-items-center"},wl={class:"d-flex align-items-center gap-2"},Fl={class:"d-flex justify-content-end align-items-center gap-3"},Tl={class:"table-responsive"},Dl={class:"table table-bordered table-striped",id:"dataTable",width:"100%",cellspacing:"0"},_l={class:"wp-5"},Cl={class:"text-muted wp-25"},Sl={class:"text-muted wp-25"},Il={class:"text-muted wp-200"},xl={class:"text-muted wp-200"},kl={class:"text-muted wp-200"},zl={class:"text-muted wp-35"},$l={class:"text-muted wp-100"},Rl=["onMousedown","onMouseenter"],Al=["title"],Ul=["href"],hl={key:0},Ml={class:"card-header d-flex justify-content-between align-items-center"},El={class:"d-flex justify-content-end align-items-center gap-3"},Ll={style:{display:"flex","justify-content":"flex-end",gap:"0.5rem","margin-top":"1rem"}},Bl={style:{display:"flex","justify-content":"flex-end",gap:"0.5rem","margin-top":"1rem"}},ql={key:1},Pl={__name:"AccountTransactions",props:{Transactionid:Number,accountid:Number},setup(Ce){const de=Pe(),oe=Oe(),O=y(!1),B=y(null),q=y(null),j=y(null),o=Me(),A=he(),V=$e();var w=y(!1),k=y(!1);y([]);const K=y(!1);y(null),y(null);const e=y({field:"ValidFrom",direction:"asc"}),G=y(null),P=y(null),Y=y(null),U=Re(),me=qe(),H=Ce;y(null),y(null);const fe=[{label:"Deposito",value:"e"},{label:"Uscita",value:"u"},{label:"Trasferimento",value:"t"}],se=[{label:"Entrata",value:"i"},{label:"Uscita",value:"o"}];function ie(){K.value=!K.value}const pe={1:"bg-danger text-white",0:"bg-success text-white",2:"bg-dark text-white"},ve={0:"fa fa-arrow-down",16:"fa fa-arrow-up",30:"fas fa-exchange-alt text-success",32:"fas fa-exchange-alt text-danger"},ye={0:"Entrata",16:"Uscita",30:"Trasferimento in entrata",32:"Trasferimento in uscita"};function ge(r){var I;const l=new Map;for(const _ of r)l.set(_.id,{key:_.id,label:_.name,data:_,children:[]});const v=[];for(const _ of r){const s=l.get(_.id),M=((I=_.parent)==null?void 0:I.id)??null;M&&l.has(M)?l.get(M).children.push(s):v.push(s)}return v}const Z=Q({get(){const r=o.currentFilter.categoryId;return r!=null?{[r]:!0}:null},set(r){console.log("NEWVVV",r),o.currentFilter.categoryId=r?parseInt(Object.keys(r)[0]):null}});function re(r){O.value=!0,B.value=r,q.value=r,Ve(event,r)}function h(r){O.value&&(q.value=r,d())}function be(){O.value=!1}function Ve(r,l){const v=o.transactions[l];if(r.ctrlKey||r.metaKey){v.selected=!v.selected,p(),j.value=l;return}if(r.shiftKey&&j.value!==null){const[_,s]=[Math.min(j.value,l),Math.max(j.value,l)];o.transactions.forEach((M,$)=>{M.selected=$>=_&&$<=s}),p();return}var I=v.selected;o.transactions.forEach(_=>_.selected=!1),console.log("click single ",I),v.selected=!I,console.log("click single after",v.selected),p(),j.value=l}function c(){o.transactions.forEach((r,l)=>{r.selected=!1}),o.selectedRows=[]}function n(){o.transactions.forEach((r,l)=>{r.selected=!0}),p()}function f(){k.value=!0}function d(){if(B.value===null||q.value===null)return;const[r,l]=[Math.min(B.value,q.value),Math.max(B.value,q.value)];o.transactions.forEach((v,I)=>{v.selected=I>=r&&I<=l}),p()}function p(){const r=o.transactions.map(v=>v.id),l=o.transactions.filter(v=>v.selected).map(v=>v.id);for(const v of l)o.selectedRows.includes(v)||o.selectedRows.push(v);o.selectedRows=o.selectedRows.filter(v=>r.includes(v)?l.includes(v):!0)}X(()=>o.currentFilter.transactionType,r=>{r!=null&&r!="t"&&(o.currentFilter.flowDirection=null)});const F=Q(()=>{console.log("TreeCS");let r=o.filterLookups.categories;var l=ge(r);return l});async function J(r){U.startLoading(),console.log("e",o),await o.deleteTransaction(r),V.showSuccess("Operazione completata"),await L(),U.stopLoading()}const ue=(r,l)=>{me.require({target:r.currentTarget,message:"Sei sicuro di voler procedere con la cancellazione del tasso di cambio selezionato?",icon:"fas fa-exclamation-triangle yellow",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Cancella",class:"bg-danger"},accept:async()=>{await J(l)},reject:()=>{}})};async function ee(){o.currentFilter.accountId!=null&&o.currentFilter.accountId,o.currentFilter.categoryId!=null&&o.currentFilter.categoryId,o.currentFilter.fromDate!=null&&o.currentFilter.fromDate,o.currentFilter.toDate!=null&&o.currentFilter.toDate,o.currentFilter.transactionType!=null&&o.currentFilter.transactionType,o.currentFilter.flowDirection!=null&&o.currentFilter.flowDirection,o.currentFilter.status!=null&&o.currentFilter.status,o.currentFilter.note!=null&&o.currentFilter.note;const r={accountId:o.currentFilter.accountId||void 0,categoryId:o.currentFilter.categoryId||void 0,fromDate:o.currentFilter.fromDate?o.currentFilter.fromDate.toISOString().split("T")[0]:void 0,toDate:o.currentFilter.toDate?o.currentFilter.toDate.toISOString().split("T")[0]:void 0,transactionType:o.currentFilter.transactionType||void 0,flowDirection:o.currentFilter.flowDirection||void 0,status:o.currentFilter.status||void 0,note:o.currentFilter.note||void 0,sortBy:e.value.field||void 0,sortOrder:e.value.direction||void 0,currentPage:o.page||void 0};console.log("Aggiorna la query string senza ricaricare la pagina",r),oe.replace({query:r})}async function te(){U.startLoading();var r=o.currentFilter.categoryId!=null?o.currentFilter.categoryId:null,l=o.currentFilter.fromDate!=null?o.currentFilter.fromDate:null,v=o.currentFilter.toDate!=null?o.currentFilter.toDate:null,I=o.currentFilter.transactionType!=null?o.currentFilter.transactionType:null,_=o.currentFilter.flowDirection!=null?o.currentFilter.flowDirection:null,s=o.currentFilter.status!=null?o.currentFilter.status:null,M=o.currentFilter.note!=null?o.currentFilter.note:null,$=H.accountid;o.currentFilter.transactionType=="t"&&($=o.currentFilter.accountId!=null?o.currentFilter.accountId:$),await ee(),await o.filterAlltransaction(H.accountid,$,r,l,v,I,_,s,M,e.value.field,e.value.direction,o.page),U.stopLoading()}async function z(r){e.value=r,await L()}async function L(){U.startLoading(),await o.loadFilterLookups(),await A.loadLookups(),await te()}Ae(async()=>{console.log("CategoryId iniziale:",o.currentFilter.categoryId);const r=de.query;o.currentFilter.accountId=r.accountId?parseInt(r.accountId):null,o.currentFilter.categoryId=r.categoryId?parseInt(r.categoryId):null,o.currentFilter.fromDate=r.fromDate?new Date(r.fromDate):null,o.currentFilter.toDate=r.toDate?new Date(r.toDate):null,o.currentFilter.transactionType=r.transactionType||null,o.currentFilter.flowDirection=r.flowDirection||null,o.currentFilter.status=r.status?parseInt(r.status):null,o.currentFilter.note=r.note||null,o.page=r.currentPage?parseInt(r.currentPage):1,e.value.field=r.sortBy||"TransactionDate",e.value.direction=r.sortOrder||"desc",await L()}),X(()=>H.Transactionid,r=>{r!=null&&(r!=0?le(r):ae())},{immediate:!0}),X(()=>H.accountid,r=>{r!=null&&(r!=0?(U.startLoading(),A.edit(r),U.stopLoading()):A.newEntity())},{immediate:!0}),X(()=>A.edititem,r=>{r!=null&&(Y.value={...A.edititem})},{immediate:!0});async function le(r){await o.edit(r),w.value=!0}function ae(){o.newEntity(),w.value=!0}async function ne(r){o.onPageChange(r.page+1),console.log("onpagechange",o.page),await ee()}async function i(){await G.value.submitForm()&&setTimeout(async function(){await L(),w.value=!1},500)}async function Le(){const r=await P.value.submitForm();console.log("saveMassiveTransactionForm",r),r&&(V.showSuccess("Operazione completata"),setTimeout(async function(){await L(),k.value=!1},500))}return(r,l)=>{const v=Ue("Error404"),I=Ie("date"),_=Ie("currency");return b(),E(Se,null,[Y.value!=null?(b(),E("div",Wt,[a("div",Jt,[u(t(We),{style:{padding:"1rem 1rem 1rem 1.5rem"}},{start:m(()=>[a("h1",Qt," Lista movimenti: ["+g(t(A).edititem.id)+"] "+g(t(A).edititem.name),1)]),center:m(()=>l[31]||(l[31]=[])),end:m(()=>[a("div",Xt,[u(t(S),{label:"Refresh",text:"",plain:"",onClick:L},{default:m(()=>l[32]||(l[32]=[a("i",{class:"fas fa-sync-alt"},null,-1)])),_:1,__:[32]}),u(t(S),{label:"Nuova operazione",text:"",plain:"",onClick:l[0]||(l[0]=s=>ae())},{default:m(()=>l[33]||(l[33]=[a("i",{class:"fa fa-plus-square"},null,-1)])),_:1,__:[33]}),u(t(S),{as:"a",label:"Filtri",text:"",plain:"",onClick:l[1]||(l[1]=s=>ie())},{default:m(()=>l[34]||(l[34]=[a("i",{class:"fa fa-filter"},null,-1)])),_:1,__:[34]})])]),_:1}),u(Xe,{accountid:H.accountid},null,8,["accountid"])]),a("div",Yt,[a("div",Zt,[a("div",null,[u(t(Ge),{visible:K.value,"onUpdate:visible":l[11]||(l[11]=s=>K.value=s),position:"right",modal:!0,style:{width:"30rem"}},{default:m(()=>[l[45]||(l[45]=a("h2",{class:"mb-4"},"Specificare i filtri",-1)),a("p",null,[a("div",el,[a("div",tl,[l[35]||(l[35]=a("label",{for:"category",class:"col-sm-3 col-form-label"},"Categoria",-1)),a("div",ll,[u(t(Ke),{modelValue:Z.value,"onUpdate:modelValue":l[2]||(l[2]=s=>Z.value=s),options:F.value,placeholder:"Seleziona categoria",class:"w-full treeselect-fixed",showClear:"true"},null,8,["modelValue","options"])])]),a("div",al,[l[36]||(l[36]=a("label",{for:"filterFromDate",class:"col-sm-3 col-form-label"},"Data Da",-1)),a("div",nl,[u(t(_e),{id:"filterFromDate",modelValue:t(o).currentFilter.fromDate,"onUpdate:modelValue":l[3]||(l[3]=s=>t(o).currentFilter.fromDate=s),maxDate:t(o).currentFilter.toDate,dateFormat:"dd/mm/yy",placeholder:"Seleziona un intervallo",showIcon:"",class:"w-full"},null,8,["modelValue","maxDate"])])]),a("div",ol,[l[37]||(l[37]=a("label",{for:"filterToDate",class:"col-sm-3 col-form-label"},"Data A",-1)),a("div",sl,[u(t(_e),{id:"filterToDate",modelValue:t(o).currentFilter.toDate,"onUpdate:modelValue":l[4]||(l[4]=s=>t(o).currentFilter.toDate=s),minDate:t(o).currentFilter.fromDate,dateFormat:"dd/mm/yy",placeholder:"Seleziona un intervallo",showIcon:"",class:"w-full"},null,8,["modelValue","minDate"])])]),a("div",il,[l[38]||(l[38]=a("label",{for:"filterTransactionType",class:"col-sm-3 col-form-label"},"Tipo",-1)),a("div",rl,[u(t(xe),{modelValue:t(o).currentFilter.transactionType,"onUpdate:modelValue":l[5]||(l[5]=s=>t(o).currentFilter.transactionType=s),options:fe,optionLabel:"label",optionValue:"value",placeholder:"Seleziona un'opzione",showClear:"",class:"w-full"},null,8,["modelValue"])])]),a("div",ul,[l[39]||(l[39]=a("label",{for:"account",class:"col-sm-3 col-form-label"},"Account",-1)),a("div",cl,[u(t(W),{name:"account",modelValue:t(o).currentFilter.accountId,"onUpdate:modelValue":l[6]||(l[6]=s=>t(o).currentFilter.accountId=s),options:t(o).filterLookups.accounts,optionLabel:"name",optionValue:"id",placeholder:"Seleziona l''account",class:"w-full"},null,8,["modelValue","options"])])]),t(o).currentFilter.transactionType!=null&&t(o).currentFilter.transactionType=="t"?(b(),E("div",dl,[l[40]||(l[40]=a("label",{for:"filterFlowDirection",class:"col-sm-3 col-form-label"},"Flusso",-1)),a("div",ml,[u(t(xe),{modelValue:t(o).currentFilter.flowDirection,"onUpdate:modelValue":l[7]||(l[7]=s=>t(o).currentFilter.flowDirection=s),options:se,optionLabel:"label",optionValue:"value",placeholder:"Seleziona un'opzione",showClear:"",class:"w-full"},null,8,["modelValue"])])])):D("",!0),a("div",fl,[l[41]||(l[41]=a("label",{for:"status",class:"col-sm-3 col-form-label"},"Stato",-1)),a("div",pl,[u(t(W),{name:"status",modelValue:t(o).currentFilter.status,"onUpdate:modelValue":l[8]||(l[8]=s=>t(o).currentFilter.status=s),options:t(o).filterLookups.statuses,optionLabel:"description",optionValue:"id",placeholder:"Seleziona lo stato",class:"w-full"},null,8,["modelValue","options"])])]),a("div",vl,[l[42]||(l[42]=a("label",{for:"note",class:"col-sm-3 col-form-label"},"Note",-1)),a("div",yl,[u(t(Ee),{name:"note",modelValue:t(o).currentFilter.note,"onUpdate:modelValue":l[9]||(l[9]=s=>t(o).currentFilter.note=s),placeholder:"Cerca nel campo note",class:"w-full"},null,8,["modelValue"])])]),a("div",gl,[l[44]||(l[44]=a("label",{for:"account",class:"col-sm-3 col-form-label"},null,-1)),a("div",bl,[u(t(S),{as:"a",label:"Filtra",text:"",plain:"",onClick:l[10]||(l[10]=s=>te())},{default:m(()=>l[43]||(l[43]=[a("i",{class:"fa fa-filter"},null,-1)])),_:1,__:[43]})])])])])]),_:1,__:[45]},8,["visible"])]),a("div",Vl,[a("div",wl,[a("span",null,g(t(o).selectedRows.length)+" righe selezionate",1),u(t(S),{label:"clear",text:"",plain:"",onClick:l[12]||(l[12]=s=>c()),title:"Rimuovi selezione"},{default:m(()=>l[46]||(l[46]=[a("i",{class:"fa fa-minus-square"},null,-1)])),_:1,__:[46]}),u(t(S),{label:"selectall",text:"",plain:"",onClick:l[13]||(l[13]=s=>n()),title:"Seleziona tutto"},{default:m(()=>l[47]||(l[47]=[a("i",{class:"fa fa-plus-square"},null,-1)])),_:1,__:[47]}),t(o).selectedRows.length>1?(b(),x(t(S),{key:0,label:"edit",text:"",plain:"",onClick:l[14]||(l[14]=s=>f()),title:"Modifica tutto"},{default:m(()=>l[48]||(l[48]=[a("i",{class:"far fa-edit"},null,-1)])),_:1,__:[48]})):D("",!0)]),a("div",Fl,[a("span",null,"Totale: "+g(t(o).totalRecords),1),u(t(ze),{rows:t(o).pageSize,totalRecords:t(o).totalRecords,first:(t(o).page-1)*t(o).pageSize,onPage:ne},null,8,["rows","totalRecords","first"])])]),a("div",Tl,[u(t(Je)),a("table",Dl,[a("thead",null,[a("tr",null,[a("th",_l,[u(N,{modelValue:e.value,"onUpdate:modelValue":[l[15]||(l[15]=s=>e.value=s),z],field:"TransactionType"},null,8,["modelValue"])]),a("th",Cl,[u(N,{modelValue:e.value,"onUpdate:modelValue":[l[16]||(l[16]=s=>e.value=s),z],field:"TransactionDate"},{default:m(()=>l[49]||(l[49]=[T(" Data ")])),_:1,__:[49]},8,["modelValue"])]),a("th",Sl,[u(N,{modelValue:e.value,"onUpdate:modelValue":[l[17]||(l[17]=s=>e.value=s),z],field:"status"},{default:m(()=>l[50]||(l[50]=[T(" Stato ")])),_:1,__:[50]},8,["modelValue"])]),a("th",Il,[u(N,{modelValue:e.value,"onUpdate:modelValue":[l[18]||(l[18]=s=>e.value=s),z],field:"Account"},{default:m(()=>l[51]||(l[51]=[T(" Account ")])),_:1,__:[51]},8,["modelValue"])]),a("th",xl,[u(N,{modelValue:e.value,"onUpdate:modelValue":[l[19]||(l[19]=s=>e.value=s),z],field:"Beneficiary"},{default:m(()=>l[52]||(l[52]=[T(" Beneficiario ")])),_:1,__:[52]},8,["modelValue"])]),a("th",kl,[u(N,{modelValue:e.value,"onUpdate:modelValue":[l[20]||(l[20]=s=>e.value=s),z],field:"Category"},{default:m(()=>l[53]||(l[53]=[T(" Categoria ")])),_:1,__:[53]},8,["modelValue"])]),a("th",zl,[u(N,{modelValue:e.value,"onUpdate:modelValue":[l[21]||(l[21]=s=>e.value=s),z],field:"Amount"},{default:m(()=>l[54]||(l[54]=[T(" Importo ")])),_:1,__:[54]},8,["modelValue"])]),l[56]||(l[56]=a("th",{class:"text-muted wp-35"}," Saldo ",-1)),a("th",$l,[u(N,{modelValue:e.value,"onUpdate:modelValue":[l[22]||(l[22]=s=>e.value=s),z],field:"Note"},{default:m(()=>l[55]||(l[55]=[T(" Note ")])),_:1,__:[55]},8,["modelValue"])]),l[57]||(l[57]=a("th",null,null,-1))])]),a("tbody",null,[(b(!0),E(Se,null,Ne(t(o).transactions,(s,M)=>(b(),E("tr",{key:s.id,class:C([{"row-selected":s.selected},s.status.cssClass]),onMousedown:we($=>re(M),["prevent"]),onMouseenter:$=>h(M),onMouseup:be},[a("td",{class:C(["text-start align-middle no-highlight",pe[s.transactionType]]),title:ye[s.transactionType*(s.flowDirection+15)]},[a("i",{class:C(ve[s.transactionType*(s.flowDirection+15)])},null,2)],10,Al),Fe(a("td",{class:C(["text-start align-middle",s.status.cssClass])},null,2),[[I,s.transactionDate,"date"]]),a("td",{class:C(["text-start align-middle",s.status.cssClass])},g(s.status.description),3),a("td",{class:C(["text-start align-middle",s.status.cssClass])},[T(g(s.account.code)+" ",1),s.destinationAccount!=null&&s.transactionType==2?(b(),E("div",{key:0,class:C(s.status.cssClass)},[a("i",{class:C({"fa fa-arrow-right":s.flowDirection==1,"fa fa-arrow-left":s.flowDirection==0})},null,2),a("a",{href:`/accounts/${s.destinationAccount.id}/transactions`,target:"_blank"},g(s.destinationAccount.code),9,Ul)],2)):D("",!0)],2),a("td",{class:C(["text-start align-middle",s.status.cssClass])},g(s.beneficiary.description),3),a("td",{class:C(["text-start align-middle",s.status.cssClass])},g(s.category.description),3),Fe(a("td",{class:C(["text-start align-middle",s.status.cssClass])},null,2),[[_,{amount:s.amount,locale:"it-IT",currency:s.currency.code}]]),Fe(a("td",{class:C(["text-start align-middle",s.status.cssClass])},null,2),[[_,{amount:s.accountBalance,locale:"it-IT",currency:s.accountCurrency.code}]]),a("td",{class:C(["text-start align-middle",s.status.cssClass])},g(s.description),3),a("td",{class:"text-start align-middle no-highlight",onMousedown:l[23]||(l[23]=we(()=>{},["stop"])),onClick:l[24]||(l[24]=we(()=>{},["stop"]))},[u(t(S),{onClick:$=>le(s.id),label:"Modifica",severity:"default",outlined:""},{default:m(()=>l[58]||(l[58]=[a("i",{class:"far fa-edit"},null,-1)])),_:2,__:[58]},1032,["onClick"]),u(t(S),{onClick:$=>ue($,s.id),label:"Delete",severity:"danger",outlined:""},{default:m(()=>l[59]||(l[59]=[a("i",{class:"far fa-minus-square"},null,-1)])),_:2,__:[59]},1032,["onClick"])],32)],42,Rl))),128)),t(o).Transaction!=null&&t(o).Transaction.length===0?(b(),E("tr",hl,l[60]||(l[60]=[a("td",{colspan:"4",class:"text-center text-muted fst-italic py-3"}," Nessuna transazione trovata ",-1)]))):D("",!0)])])]),a("div",Ml,[l[61]||(l[61]=a("div",{class:"d-flex align-items-center gap-2"},null,-1)),a("div",El,[a("span",null,"Totale: "+g(t(o).totalRecords),1),u(t(ze),{rows:t(o).pageSize,totalRecords:t(o).totalRecords,first:(t(o).page-1)*t(o).pageSize,onPage:ne},null,8,["rows","totalRecords","first"])])]),u(t(ke),{header:"Transazione",visible:t(w),"onUpdate:visible":l[27]||(l[27]=s=>ce(w)?w.value=s:w=s),modal:!0,closable:!0,style:{width:"50rem"}},{default:m(()=>[u(He,{ref_key:"editForm",ref:G},null,512),a("div",Ll,[u(t(S),{type:"button",label:"Cancel",severity:"secondary",onClick:l[25]||(l[25]=s=>ce(w)?w.value=!1:w=!1)}),u(t(S),{type:"button",label:"Save",class:"bg-gray-800 text-white border-none hover:bg-gray-800",onClick:l[26]||(l[26]=s=>i())})])]),_:1},8,["visible"]),u(t(ke),{header:"Modifica massiva",visible:t(k),"onUpdate:visible":l[30]||(l[30]=s=>ce(k)?k.value=s:k=s),modal:!0,closable:!0,style:{width:"50rem"}},{default:m(()=>[u(Ht,{ref_key:"massiveEditForm",ref:P},null,512),a("div",Bl,[u(t(S),{type:"button",label:"Cancel",severity:"secondary",onClick:l[28]||(l[28]=s=>ce(k)?k.value=!1:k=!1)}),u(t(S),{type:"button",label:"Save",class:"bg-gray-800 text-white border-none hover:bg-gray-800",onClick:l[29]||(l[29]=s=>Le())})])]),_:1},8,["visible"])])])])):D("",!0),t(A).edititem==null&&!t(U).loading?(b(),E("div",ql,[u(v,{backaction:/accounts/})])):D("",!0)],64)}}},sa=Be(Pl,[["__scopeId","data-v-ea3d5080"]]);export{sa as default};
